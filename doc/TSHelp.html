<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<script type="text/javascript">
var version = {major: 1, minor: 2, revision: 32, date: new Date("Aug 18, 2005"), extensions: {}};
</script>
<!--
TiddlyWiki 1.2.32 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)
Incorporating improvements by Isao Sonobe, http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html
GTDTiddlyWiki modification by Nathan Bowers, (wiki [at] snapgrid [dot] com)
Safari Compatability by Jonathan Paisley at http://www.dcs.gla.ac.uk/~jp/

Copyright (c) Osmosoft Limited, 14 April 2005

All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="description" content="A Getting Things Done adaptation of TiddlyWiki.">
<meta name="keywords" content="Getting Things Done Wiki, GTDTiddlyWiki, GTD TiddlyWiki, GTD Wiki, Personal productivity wiki">
<title>TableSmith 5.1</title>
<script type="text/javascript">

// ---------------------------------------------------------------------------------
// Configuration repository
// ---------------------------------------------------------------------------------

var config = {
	// Options that can be set in the options panel and/or cookies
	options: {
		chkRegExpSearch: false,
		chkCaseSensitiveSearch: false,
		chkAnimate: true,
		txtUserName: "YourName",
		chkSaveBackups: true,
		chkAutoSave: false,
		chkGenerateAnRssFeed: false,
		chkSaveEmptyTemplate: false,
		chkOpenInNewWindow: true,
		chkToggleLinks: false,
		chkHttpReadOnly: false,
		txtMainTab: "tabTimeline",
		txtMoreTab: "moreTabAll"
		},
	// Hashmap of notification functions to be called when certain tiddlers are changed or deleted
	notifyNamedTiddlers: {
		SiteTitle: refreshTitle,
		SiteSubtitle: refreshSubtitle,
		SideBarOptions: refreshSidebar,
		StyleSheet: refreshStyles
		},
	// List of notification functions to be called when any tiddler is changed or deleted
	notifyTiddlers: [
		refreshMenu,
		refreshStory,
		refreshTabs
		],
	// Shadow tiddlers for emergencies
	shadowTiddlers: {
		SideBarOptions: "<<search>><<closeAll>><<permaview>><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel options 'Change TiddlyWiki advanced options'>>",
		OptionsPanel: "These InterfaceOptions for customising TiddlyWiki are saved in your browser\n\nYour username for signing your edits. Write it as a WikiWord (eg JoeBloggs)\n\n<<option txtUserName>>\n<<option chkSaveBackups>> SaveBackups\n<<option chkAutoSave>> AutoSave\n<<option chkGenerateAnRssFeed>> GenerateAnRssFeed\n<<option chkRegExpSearch>> RegExpSearch\n<<option chkCaseSensitiveSearch>> CaseSensitiveSearch\n<<option chkAnimate>> EnableAnimations\n\nSee AdvancedOptions",
		AdvancedOptions: "<<option chkOpenInNewWindow>> OpenLinksInNewWindow\n<<option chkSaveEmptyTemplate>> SaveEmptyTemplate\n<<option chkToggleLinks>> Clicking on links to tiddlers that are already open causes them to close\n^^(override with Control or other modifier key)^^\n<<option chkHttpReadOnly>> HideEditingFeatures when viewed over HTTP",
		SideBarTabs: "<<tabs txtMainTab Timeline Timeline TabTimeline All 'All tiddlers' TabAll Tags 'All tags' TabTags More 'More lists' TabMore>>",
		TabTimeline: "<<timeline>>",
		TabAll: "<<list all>>",
		TabTags: "<<allTags>>",
		TabMore: "<<tabs txtMoreTab Missing 'Missing tiddlers' TabMoreMissing Orphans 'Orphaned tiddlers' TabMoreOrphans>>",
		TabMoreMissing: "<<list missing>>",
		TabMoreOrphans: "<<list orphans>>"
		},
	// Miscellaneous options
	numRssItems: 20, // Number of items in the RSS feed
	animFast: 0.12, // Speed for animations (lower == slower)
	animSlow: 0.01, // Speed for EasterEgg animations
	// Messages
	messages: {
		customConfigError: "Error in customConfig - %0",
		savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
		subtitleUnknown: "(unknown)",
		undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
		externalLinkTooltip: "External link to %0",
		noTags: "There are no tagged tiddlers",
		notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
		cantSaveError: "It's not possible to save changes using this browser. Use FireFox if you can",
		invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
		backupSaved: "Backup saved",
		backupFailed: "Failed to save backup file",
		rssSaved: "RSS feed saved",
		rssFailed: "Failed to save RSS feed file",
		emptySaved: "Empty template saved",
		emptyFailed: "Failed to save empty template file",
		mainSaved: "Main TiddlyWiki file saved",
		mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
		macroError: "Error executing macro '%0'",
		overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
		unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
		dates: {
			months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"],
			days: ["Sunday", "Monday","Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
			}
		},
	views: {
		wikified: {
			tag: {labelNoTags: "no tags", labelTags: "tags: ", tooltip: "Show tiddlers tagged with '%0'", openAllText: "Open all", openAllTooltip: "Open all of these tiddlers", popupNone: "No other tiddlers tagged with '%0'"},
			toolbarClose: {text: "close", tooltip: "Close this tiddler"},
			toolbarEdit: {text: "edit", tooltip: "Edit this tiddler"},
			toolbarPermalink: {text: "permalink", tooltip: "Permalink for this tiddler"},
			toolbarReferences: {text: "references", tooltip: "Show tiddlers that link to this one", popupNone: "No references"},
			defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it"
			},
		editor: {
			tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
			tagChooser: {text: "tags", tooltip: "Choose existing tags to add to this tiddler", popupNone: "There are no tags defined", tagTooltip: "Add the tag '%0'"},
			toolbarDone: {text: "done", tooltip: "Save changes to this tiddler"},
			toolbarCancel: {text: "cancel", tooltip: "Undo changes to this tiddler"},
			toolbarDelete: {text: "delete", tooltip: "Delete this tiddler"},
			defaultText: "Type the text for '%0'"
			}
		},
	macros: { // Each has a 'handler' member that is inserted later
		today: {},
		version: {},
		search: {label: "search", prompt: "Search this TiddlyWiki", sizeTextbox: 15, successMsg: "%0 tiddlers found matching %1", failureMsg: "No tiddlers found matching %0"},
		tiddler: {},
		tag: {},
		timeline: {dateFormat: "DD MMM YYYY"},
		allTags: {tooltip: "Show tiddlers tagged with '%0'", noTags: "There are no tagged tiddlers"},
		list: {
			all: {prompt: "All tiddlers in alphabetical order"},
			missing: {prompt: "Tiddlers that have links to them but are not defined"},
			orphans: {prompt: "Tiddlers that are not linked to from any other tiddlers"}
			},
		closeAll: {label: "close all", prompt: "Close all displayed tiddlers (except any that are being edited)"},
		permaview: {label: "permaview", prompt: "Link to an URL that retrieves all the currently displayed tiddlers"},
		saveChanges: {label: "save changes", prompt: "Save all tiddlers to create a new TiddlyWiki"},
		slider: {},
		option: {},
		newTiddler: {label: "new tiddler", prompt: "Create a new tiddler", title: "New Tiddler"},
		newJournal: {label: "new journal", prompt: "Create a new tiddler from the current date and time"},
		sparkline: {},
		tabs: {}
		}
};

// ---------------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------------

// TiddlyWiki storage
var store = new TiddlyWiki();

// Animation engine
var anim = new Animator();

var readOnly = false;

// Starting up
function main()
{
	readOnly = (document.location.toString().substr(0,7) == "http://") ? config.options.chkHttpReadOnly : false;
	setupRegexp();
	saveTest();
	loadOptionsCookie();
	var s;
	for(s in config.notifyNamedTiddlers)
		store.addNotification(s,config.notifyNamedTiddlers[s]);
	for(s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(null,config.notifyTiddlers[s]);
	store.loadFromDiv("storeArea","store");
	loadSystemConfig();
	store.notifyAll();
	var start = store.getTiddlerText("DefaultTiddlers");
	if(window.location.hash)
		displayTiddlers(null,convertUTF8ToUnicode(decodeURI(window.location.hash.substr(1))),1,null,null);
	else if(start)
		displayTiddlers(null,start,1,null,null);
}

function saveTest()
{
	var saveTest = document.getElementById("saveTest");
	if(saveTest.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	saveTest.appendChild(document.createTextNode("savetest"));
}

function loadSystemConfig()
{
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(var t=0; t<configTiddlers.length; t++)
		{
		var ex = processConfig(configTiddlers[t].text);
		if(ex)
			displayMessage(config.messages.customConfigError.format([ex]));
		}
}

// ---------------------------------------------------------------------------------
// Macro definitions
// ---------------------------------------------------------------------------------

config.macros.today.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,(new Date()).toLocaleString());
}

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision);
}

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var theList = document.createElement("ul");
	place.appendChild(theList);
	if(this[type].prompt)
		createTiddlyElement(theList,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for (t = 0; t < results.length; t++)
		{
		theListItem = document.createElement("li")
		theList.appendChild(theListItem);
		if(typeof results[t] == "string")
			createTiddlyLink(theListItem,results[t],true);
		else
			createTiddlyLink(theListItem,results[t].title,true);
		}
}

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
}

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
}

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
}

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags();
	var theDateList = createTiddlyElement(place,"ul",null,null,null);
	if(tags.length == 0)
		createTiddlyElement(theDateList,"li",null,"listTitle",this.noTags);
	for (t=0; t<tags.length; t++)
		{
		var theListItem =createTiddlyElement(theDateList,"li",null,null,null);
		var theTag = createTiddlyButton(theListItem,tags[t][0] + " (" + tags[t][1] + ")",this.tooltip.format([tags[t][0]]),onClickTag);
		theTag.setAttribute("tag",tags[t][0]);
		}
}

config.macros.timeline.handler = function(place,macroName,params)
{
	var tiddlers = store.reverseLookup("tags","excludeLists",false,"modified");
	var lastDay = "";
	for (t=tiddlers.length-1; t>=0; t--)
		{
		var tiddler = tiddlers[t];
		var theDay = tiddler.modified.convertToYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay)
			{
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler.modified.formatString(this.dateFormat));
			lastDay = theDay;
			}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink",null);
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
		}
}

config.macros.search.handler = function(place,macroName,params)
{
	var lastSearchText = "";
	var searchTimeout = null;
	var doSearch = function(txt)
		{
		closeAllTiddlers();
		var matches = store.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch,"title","excludeSearch");
		for(var t=matches.length-1; t>=0; t--)
			displayTiddler(null,matches[t].title,0,txt.value,config.options.chkCaseSensitiveSearch,false,false);
		var q = config.options.chkRegExpSearch ? "/" : "'";
		if(matches.length > 0)
			displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + txt.value + q]));
		else
			displayMessage(config.macros.search.failureMsg.format([q + txt.value + q]));
		lastSearchText = txt.value;
		};
	var clickHandler = function(e)
		{
		doSearch(this.nextSibling);
		};
	var keyHandler = function(e)
		{
		if (!e) var e = window.event;
		switch(e.keyCode)
			{
			case 27:
				this.value = "";
				clearMessage();
				break;
			}
		if((this.value.length > 2) && (this.value != lastSearchText))
			{
			if(searchTimeout)
				clearTimeout(searchTimeout);
			var txt = this;
			searchTimeout = setTimeout(function() {doSearch(txt);},200);
			}
		};
	var focusHandler = function(e)
		{
		this.select();
		};
	var btn = createTiddlyButton(place,this.label,this.prompt,clickHandler);
	var txt = createTiddlyElement(place,"input",null,null,null);
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = keyHandler;
	txt.onfocus = focusHandler;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("autocomplete","off");
	if(navigator.userAgent.toLowerCase().indexOf("safari") == -1)
		txt.setAttribute("type","text");
	else
		{
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
		}
}

config.macros.tiddler.handler = function(place,macroName,params)
{
	var wrapper = createTiddlyElement(place,"span",null,params[1] ? params[1] : null,null);
	var text = store.getTiddlerText(params[0]);
	if(text)
		wikify(text,wrapper,null,null);
}

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
}

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,closeAllTiddlers);
}

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,onClickPermaView);
}

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,saveChanges);
}

config.macros.slider.onClickSlider = function(e)
{
	if (!e) var e = window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate)
		anim.startAnimating(new Slider(n,!isOpen,e.shiftKey || e.altKey,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
}

config.macros.slider.handler = function(place,macroName,params)
{
	var cookie = params[0] ? params[0] : "";
	var text = store.getTiddlerText(params[1]);
	var btn = createTiddlyButton(place,params[2],params[3],this.onClickSlider);
	var panel = createTiddlyElement(place,"div",null,"sliderPanel",null);
	panel.setAttribute("cookie",cookie);
	panel.style.display = config.options[cookie] ? "block" : "none";
	if(text)
		wikify(text,panel,null,null);
}

config.macros.option.onChangeOption = function(e)
{
	var opt = this.getAttribute("option");
	var elementType,valueField;
	if(opt)
		{
		switch(opt.substr(0,3))
			{
			case "txt":
				elementType = "input";
				valueField = "value";
				break;
			case "chk":
				elementType = "input";
				valueField = "checked";
				break;
			}
		config.options[opt] = this[valueField];
		saveOptionCookie(opt);
		var nodes = document.getElementsByTagName(elementType);
		for(var t=0; t<nodes.length; t++)
			{
			var optNode = nodes[t].getAttribute("option");
			if(opt == optNode)
				nodes[t][valueField] = this[valueField];
			}
		}
	return(true);
}

config.macros.option.handler = function(place,macroName,params)
{
	var opt = params[0];
	if(config.options[opt] == undefined)
		return;
	var c;
	switch(opt.substr(0,3))
		{
		case "txt":
			c = document.createElement("input");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.size = 15;
			c.value = config.options[opt];
			place.appendChild(c);
			break;
		case "chk":
			c = document.createElement("input");
			c.setAttribute("type","checkbox");
			c.onclick = this.onChangeOption;
			c.setAttribute("option",opt);
			c.checked = config.options[opt];
			place.appendChild(c);
			break;
		}
}

config.macros.newTiddler.onClick = function()
{
	displayTiddler(null,config.macros.newTiddler.title,2,null,null,false,false);
	var e = document.getElementById("editorTitle" + config.macros.newTiddler.title);
	e.focus();
	e.select();
}

config.macros.newTiddler.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.newJournal.handler = function(place,macroName,params)
{
	if(!readOnly)
		{
		var now = new Date();
		var title = now.formatString(params[0].trim());
		var createJournal = function() {
			displayTiddler(null,title,2,null,null,false,false);
			var tagsBox = document.getElementById("editorTags" + title);
			if(tagsBox && params[1])
				tagsBox.value += " " + String.encodeTiddlyLink(params[1]);
			};
		createTiddlyButton(place,this.label,this.prompt,createJournal);
		}
}

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	for(var t=0; t<params.length; t++)
		{
		var v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
		}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++)
		{
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		var v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
		}
}

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(place,"div",null,cookie,null);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset",null);
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++)
		{
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("href","javascript:;");
		tab.onclick = this.onClickTab;
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
		}
	if(!validTab)
		config.options[cookie] = params[1];
	this.switchTab(tabset,config.options[cookie]);
}

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
}

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++)
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab)
			{
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
			}
		else
			nodes[t].className = "tab tabUnselected"
	if(theTab)
		{
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			tabset.parentNode.removeChild(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents",null);
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		wikify(store.getTiddlerText(theTab.getAttribute("content")),tabContent,null,null);
		if(cookie)
			{
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
			}
		}
}

// ---------------------------------------------------------------------------------
// Config and macro stuff
// ---------------------------------------------------------------------------------

// Merge a custom configuration over the top of the current configuration
// Returns a string error message or null if it went OK
function processConfig(customConfig)
{
	try
		{
		if(customConfig && customConfig != "")
			window.eval(customConfig);
		}
	catch(e)
		{
		return(e.toString());
		}
	return null;
}

// Render a macro
function insertMacro(place,macroName,macroParams)
{
	var params = macroParams.readMacroParams();
	try
		{
		var macro = config.macros[macroName];
		if(macro && macro.handler)
			macro.handler(place,macroName,params);
		else
			createTiddlyElement(place,"span",null,"errorNoSuchMacro","<<" + macroName + ">>");
		}
	catch(e)
		{
		displayMessage(config.messages.macroError.format([macroName]));
		displayMessage(e.toString());
		}
}

// ---------------------------------------------------------------------------------
// Tiddler() object
// ---------------------------------------------------------------------------------

function Tiddler()
{
	this.title = null;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.links = [];
	this.tags = [];
	return this;
}

// Load a tiddler from an HTML DIV
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	var text = Tiddler.unescapeLineBreaks(divRef.firstChild ? divRef.firstChild.nodeValue : "");
	var modifier = divRef.getAttribute("modifier");
	var modified = Date.convertFromYYYYMMDDHHMM(divRef.getAttribute("modified"));
	var tags = divRef.getAttribute("tags");
	this.set(title,text,modifier,modified,tags);
	return this;
}

// Format the text for storage in an HTML DIV
Tiddler.prototype.saveToDiv = function()
{
	return '<div tiddler="' + this.title + '" modified="' +
							this.modified.convertToYYYYMMDDHHMM() + '" modifier="' + this.modifier +
							'" tags="' + this.getTags() + '">' +
							this.escapeLineBreaks().htmlEncode() + '</div>';
}

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title>" + this.title.htmlEncode() + "</title>");
	s.push("<description>" + this.text.replace(regexpNewLine,"<br />").htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return(s.join("\n"));
}

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else
		this.tags = [];
	this.changed();
	return this;
}

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	if(this.tags)
		{
		var results = [];
		for(var t=0; t<this.tags.length; t++)
			results.push(String.encodeTiddlyLink(this.tags[t]));
		return results.join(" ");
		}
	else
		return "";
}

var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

// Static method to Convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	if(text && text != "")
		return text.replace(regexpBackSlashEn,"\n").replace(regexpBackSlashEss,"\\").replace(regexpCarriageReturn,"");
	else
		return "";
}

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.replace(regexpBackSlash,"\\s").replace(regexpNewLine,"\\n").replace(regexpCarriageReturn,"");
}

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var nextPos = 0;
	var theLink;
	do {
		var formatMatch = wikiNameRegExp.exec(this.text);
		if(formatMatch)
			{
			if(!formatMatch[1] && formatMatch[2] && formatMatch[2] != this.title)
				this.links.pushUnique(formatMatch[2]);
			else if(formatMatch[4] && store.tiddlers[formatMatch[5]] != undefined)
				this.links.pushUnique(formatMatch[5]);
			else if(formatMatch[6] && formatMatch[6] != this.title)
				this.links.pushUnique(formatMatch[6]);
			}
	} while(formatMatch);
	return;
}

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return(theModifier + ", " + theModified);
}

// ---------------------------------------------------------------------------------
// TiddlyWiki() object contains Tiddler()s
// ---------------------------------------------------------------------------------

function TiddlyWiki()
{
	this.tiddlers = {}; // Hashmap by name of tiddlers
	this.namedNotifications = {}; // Hashmap by name of array of notification functions
	this.blanketNotifications = []; // Array of blanket notifications to be invoked on any change
	this.dirty = false;
}

// Set the dirty flag
TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
}

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	var notification = this.namedNotifications[title];
	if(notification)
		for(var t=0; t<notification.length; t++)
			notification[t](title);
	if(doBlanket)
		for(var n=0; n<this.blanketNotifications.length; n++)
			this.blanketNotifications[n](title);
}

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	var notifyTitle;
	for(notifyTitle in this.tiddlers)
		this.notify(notifyTitle,false);
	for(notifyTitle in config.shadowTiddlers)
		if(this.tiddlers[notifyTitle] == undefined)
			this.notify(notifyTitle,false);
	for(var n=0; n<this.blanketNotifications.length; n++)
		this.blanketNotifications[n]();
}

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	var notification;
	if(title)
		{
		notification = this.namedNotifications[title];
		if(!notification)
			{
			notification = [];
			this.namedNotifications[title] = notification;
			}
		}
	else
		notification = this.blanketNotifications;
	notification.push(fn);
	return this;
}

// Clear a TiddlyWiki so that it contains no tiddlers
TiddlyWiki.prototype.clear = function(src)
{
	this.tiddlers = {};
	this.dirty = false;
}

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.tiddlers[title];
	if(tiddler)
		{
		delete this.tiddlers[title];
		this.notify(title,true);
		this.dirty = true;
		}
}

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return(defaultText);
	var tiddler = this.tiddlers[title];
	if(tiddler)
		return tiddler.text;
	else if(config.shadowTiddlers[title])
		return config.shadowTiddlers[title];
	else if(defaultText)
		return defaultText;
	else
		return null;
}

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,ignoreList)
{
	var childIgnoreList = ignoreList ? ignoreList : {};
	childIgnoreList[title] = true;
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,defaultText);
	if(text == null)
		return "";
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match)
			{
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1])
				{
				if(childIgnoreList[match[1]])
					textOut.push(match[1]);
				else
					{
					var subText = this.getRecursiveTiddlerText(match[1],match[1],childIgnoreList);
					textOut.push(subText);
					}
				}
			lastPos = match.index + match[1].length + 4;
			}
		else
			textOut.push(text.substr(lastPos));
	} while(match);
	delete childIgnoreList[title];
	return(textOut.join(""));
}

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags)
{
	var tiddler = this.tiddlers[title];
	if(tiddler)
		delete this.tiddlers[title];
	else
		tiddler = new Tiddler();
	tiddler.set(newTitle,newBody,modifier,modified,tags);
	this.tiddlers[newTitle] = tiddler;
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.dirty = true;
	return tiddler;
}

TiddlyWiki.prototype.createTiddler = function(title)
{
	tiddler = this.tiddlers[title];
	if(!tiddler)
		{
		tiddler = new Tiddler();
		this.tiddlers[title] = tiddler;
		this.dirty = true;
		}
	return tiddler;
}

// Load contents of a tiddlywiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(srcID,idPrefix)
{
	if(document.normalize)
		document.normalize();
	var lenPrefix = idPrefix.length;
	var store = document.getElementById(srcID).childNodes;
	for(var t = 0; t < store.length; t++)
		{
		var e = store[t];
		var title = null;
		if(e.getAttribute)
			title = e.getAttribute("tiddler");
		if(!title && e.id && e.id.substr(0,lenPrefix) == idPrefix)
			title = e.id.substr(lenPrefix);
		if(title && title != "")
			{
			var tiddler = this.createTiddler(title);
			tiddler.loadFromDiv(e,title);
			}
		}
	this.dirty = false;
}

// Return an array of tiddlers matching a search string
TiddlyWiki.prototype.search = function(searchText,caseSensitive,useRegExp,sortField,excludeTag)
{
	if (!useRegExp)
		searchText = searchText.escapeRegExp();
	var regExp = new RegExp(searchText,caseSensitive ? "m" : "im");
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++)
		{
		if(regExp.test(candidates[t].title) || regExp.test(candidates[t].text))
			results.push(candidates[t]);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function (a,b) {if(a[sortField] == b[sortField]) return(0); else return (a[sortField] < b[sortField]) ? -1 : +1; });
	return results;
}

// Return an array of all the tags in use. Each member of the array is another array where [0] is the name of the tag and [1] is the number of occurances
TiddlyWiki.prototype.getTags = function()
{
	var results = [];
	for(var t in this.tiddlers)
		{
		var tiddler = this.tiddlers[t];
		for(g=0; g<tiddler.tags.length; g++)
			{
			var tag = tiddler.tags[g];
			var f = false;
			for(var c=0; c<results.length; c++)
				if(results[c][0] == tag)
					{
					f = true;
					results[c][1]++;
					}
			if(!f)
				results.push([tag,1]);
			}
		}
	results.sort(function (a,b) {if(a[0] == b[0]) return(0); else return (a[0] < b[0]) ? -1 : +1; });
	return results;
}

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
}

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,exclude,sortField)
{
	return this.reverseLookup("links",title,true,sortField);
}

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	for(var t in this.tiddlers)
		{
		var tiddler = this.tiddlers[t];
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++)
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		if(f)
			results.push(tiddler);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function (a,b) {if(a[sortField] == b[sortField]) return(0); else return (a[sortField] < b[sortField]) ? -1 : +1; });
	return results;
}

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field)
{
	var results = [];
	for(var t in this.tiddlers)
		results.push(this.tiddlers[t]);
	if(field)
		results.sort(function (a,b) {if(a[field] == b[field]) return(0); else return (a[field] < b[field]) ? -1 : +1; });
	return results;
}

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	var results = [];
	for(var t in this.tiddlers)
		{
		var tiddler = this.tiddlers[t];
		for(var n=0; n<tiddler.links.length;n++)
			{
			var link = tiddler.links[n];
			if(this.tiddlers[link] == null)
				results.pushUnique(link);
			}
		}
	results.sort();
	return results;
}

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	for(var t in this.tiddlers)
		if(this.getReferringTiddlers(t).length == 0)
			results.push(t);
	results.sort();
	return results;
}

// ---------------------------------------------------------------------------------
// Tiddler functions
// ---------------------------------------------------------------------------------

// Display several tiddlers from a list of space separated titles
function displayTiddlers(src,titles,state,highlightText,highlightCaseSensitive,animate,slowly)
{
	var tiddlerNames = titles.readBracketedList();
	for(var t = tiddlerNames.length-1;t>=0;t--)
		displayTiddler(src,tiddlerNames[t],state,highlightText,highlightCaseSensitive,animate,slowly);
}

// Display a tiddler with animation and scrolling, as though a link to it has been clicked on
//	src = source element object (eg link) for animation effects and positioning
//	title = title of tiddler to display
//	state = 0 is default or current state, 1 is read only and 2 is edittable
//	highlightText = text to highlight in the displayed tiddler
//	highlightCaseSensitive = flag for whether the highlight text is case sensitive
function displayTiddler(src,title,state,highlightText,highlightCaseSensitive,animate,slowly)
{
	var place = document.getElementById("tiddlerDisplay");
	var after = findContainingTiddler(src); // Which tiddler this one will be positioned after
	var before;
	if(after == null)
		before = place.firstChild;
	else if(after.nextSibling)
		before = after.nextSibling;
	else
		before = null;
	var theTiddler = createTiddler(place,before,title,state,highlightText,highlightCaseSensitive);
	if(src)
		{
		if(config.options.chkAnimate && (animate == undefined || animate == true))
			anim.startAnimating(new Zoomer(title,src,theTiddler,slowly),new Scroller(theTiddler,slowly));
		else
			window.scrollTo(0,ensureVisible(theTiddler));
		}
}

// Create a tiddler if it doesn't exist (with no fancy animating)
//	place = parent element
//	before = node before which to create/move the tiddler
//	title = title of tiddler to display
//	state = 0 is default or current state, 1 is read only and 2 is edittable
//	highlightText = text to highlight in the displayed tiddler
//	highlightCaseSensitive = flag for whether the highlight text is case sensitive
function createTiddler(place,before,title,state,highlightText,highlightCaseSensitive)
{
	var theTiddler = createTiddlerSkeleton(place,before,title);
	createTiddlerTitle(title,highlightText,highlightCaseSensitive);
	var theViewer = document.getElementById("viewer" + title);
	var theEditor = document.getElementById("editorWrapper" + title);
	switch(state)
		{
		case 0:
			if(!theViewer && !theEditor)
				{
				createTiddlerToolbar(title,false);
				createTiddlerViewer(title,highlightText,highlightCaseSensitive);
				createTiddlerFooter(title,false);
				}
			break;
		case 1: // Viewer
			if(theViewer)
				theViewer.parentNode.removeChild(theViewer);
			if(theEditor)
				theEditor.parentNode.removeChild(theEditor);
			createTiddlerToolbar(title,false);
			createTiddlerViewer(title,highlightText,highlightCaseSensitive);
			createTiddlerFooter(title,false);
			break;
		case 2: // Editor
			if(!theEditor)
				{
				if(theViewer)
					theViewer.parentNode.removeChild(theViewer);
				createTiddlerToolbar(title,true);
				createTiddlerEditor(title);
				createTiddlerFooter(title,true);
				}
			break;
		}
	return(theTiddler);
}

function refreshTiddler(title)
{
	var theViewer = document.getElementById("viewer" + title);
	if(theViewer)
		{
		theViewer.parentNode.removeChild(theViewer);
		createTiddlerViewer(title,null,null);
		}
}

function createTiddlerSkeleton(place,before,title)
{
	var theTiddler = document.getElementById("tiddler" + title);
	if(!theTiddler)
		{
		theTiddler = createTiddlyElement(null,"div","tiddler" + title,"tiddler",null);
		theTiddler.onmouseover = onMouseOverTiddler;
		theTiddler.onmouseout = onMouseOutTiddler;
		theTiddler.ondblclick = onDblClickTiddler;
		var theInnerTiddler = createTiddlyElement(theTiddler,"div",null,"unselectedTiddler",null);
		var theToolbar = createTiddlyElement(theInnerTiddler,"div","toolbar" + title,"toolbar", null);
		var theTitle = createTiddlyElement(theInnerTiddler,"div","title" + title,"title",null);
		var theBody = createTiddlyElement(theInnerTiddler,"div","body" + title,"body",null);
		var theFooter = createTiddlyElement(theInnerTiddler,"div","footer" + title,"footer",null);
		place.insertBefore(theTiddler,before);
		}
	return(theTiddler);
}

function createTiddlerTitle(title,highlightText,highlightCaseSensitive)
{
	var theTitle = document.getElementById("title" + title);
	if(theTitle)
		{
		removeChildren(theTitle);
		if(highlightText == "")
			highlightText = null;
		var highlightRegExp,highlightMatch;
		if(highlightText)
			{
			highlightRegExp = new RegExp(highlightText,highlightCaseSensitive ? "mg" : "img");
			highlightMatch = highlightRegExp.exec(title);
			}
		highlightMatch = subWikify(theTitle,title,0,title.length,highlightRegExp,highlightMatch);
		var tiddler = store.tiddlers[title];
		if(tiddler)
			theTitle.title = tiddler.getSubtitle();
		}
}

// Create a tiddler toolbar according to whether it's an editor or not
function createTiddlerToolbar(title,isEditor)
{
	var theToolbar = document.getElementById("toolbar" + title);
	var lingo = config.views;
	if(theToolbar)
		{
		removeChildren(theToolbar);
		insertSpacer(theToolbar);
		if(isEditor)
			{
			// Editor toolbar
			lingo = lingo.editor;
			createTiddlyButton(theToolbar,lingo.toolbarDone.text,lingo.toolbarDone.tooltip,onClickToolbarSave);
			insertSpacer(theToolbar);
			createTiddlyButton(theToolbar,lingo.toolbarCancel.text,lingo.toolbarCancel.tooltip,onClickToolbarUndo);
			insertSpacer(theToolbar);
			createTiddlyButton(theToolbar,lingo.toolbarDelete.text,lingo.toolbarDelete.tooltip,onClickToolbarDelete);
			}
		else
			{
			// Viewer toolbar
			lingo = lingo.wikified;
			createTiddlyButton(theToolbar,lingo.toolbarClose.text,lingo.toolbarClose.tooltip,onClickToolbarClose);
			insertSpacer(theToolbar);
			if(!readOnly)
				{
				createTiddlyButton(theToolbar,lingo.toolbarEdit.text,lingo.toolbarEdit.tooltip,onClickToolbarEdit);
				insertSpacer(theToolbar);
				}
			createTiddlyButton(theToolbar,lingo.toolbarPermalink.text,lingo.toolbarPermalink.tooltip,onClickToolbarPermaLink);
			insertSpacer(theToolbar);
			createTiddlyButton(theToolbar,lingo.toolbarReferences.text,lingo.toolbarReferences.tooltip,onClickToolbarReferences);
			}
		insertSpacer(theToolbar);
		}
}

function createTiddlerPopup(srcElement)
{
	var popup = document.getElementById("popup");
	if(popup && popup.nextSibling == srcElement)
		{
		hideTiddlerPopup();
		return null;
		}
	if(popup)
		popup.parentNode.removeChild(popup);
	popup = createTiddlyElement(null,"div","popup",null,null);
	var leftPx = srcElement.offsetLeft;
	var topPx = srcElement.offsetTop;
	var heightPx = srcElement.offsetHeight;
	if (leftPx <= 1 && srcElement.parentNode.offsetLeft > 0)
		leftPx = srcElement.parentNode.offsetLeft;
	if (topPx <= 1 && srcElement.parentNode.offsetTop > 0)
		topPx = srcElement.parentNode.offsetTop;
	if (heightPx <= 1 && srcElement.parentNode.offsetHeight > 0)
		heightPx = srcElement.parentNode.offsetHeight;
	popup.style.left = leftPx + "px";
	popup.style.top = topPx + heightPx + "px";
	popup.style.display = "block";
	srcElement.onmouseout = onMouseOutTiddlerPopup;
	srcElement.appendChild(popup);
	return popup;
}

function scrollToTiddlerPopup(popup,slowly)
{
	if(config.options.chkAnimate)
		anim.startAnimating(new Scroller(popup,slowly));
	else
		window.scrollTo(0,ensureVisible(popup));
}

function onMouseOutTiddlerPopup(e)
{
	if (!e) var e = window.event;
	var related = (e.relatedTarget) ? e.relatedTarget : e.toElement;
	try
		{
		while (related != this && related && related.nodeName && related.nodeName.toLowerCase() != "body")
			related = related.parentNode;
		}
	catch(e)
		{
		related = null;
		}
	if(related != this)
		{
		this.onmouseout = null;
		hideTiddlerPopup();
		}
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

function hideTiddlerPopup()
{
	var popup = document.getElementById("popup");
	if(popup)
		popup.parentNode.removeChild(popup);
}

// Create the body section of a read-only tiddler
function createTiddlerViewer(title,highlightText,highlightCaseSensitive,htmlElement)
{
	var theBody = document.getElementById("body" + title);
	if(theBody)
		{
		var tiddler = store.tiddlers[title];
		var tiddlerText = store.getTiddlerText(title);
		var theViewer = createTiddlyElement(theBody,htmlElement ? htmlElement : "div","viewer" + title,"viewer",null);
		if(tiddler)
			theViewer.setAttribute("tags",tiddler.tags.join(" "));
		if(tiddlerText == null)
			{
			tiddlerText = config.views.wikified.defaultText.format([title]);
			theViewer.style.fontStyle = "italic";
			}
		wikify(tiddlerText,theViewer,highlightText,highlightCaseSensitive);
		}
}

// Create the footer section of a tiddler
function createTiddlerFooter(title,isEditor)
{
	var theFooter = document.getElementById("footer" + title);
	var tiddler = store.tiddlers[title];
	if(theFooter && tiddler)
		{
		removeChildren(theFooter);
		insertSpacer(theFooter);
		if(isEditor)
			{
			}
		else
			{
			var lingo = config.views.wikified.tag;
			var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
			var theTags = createTiddlyElement(theFooter,"div",null,null,prompt);
			for(var t=0; t<tiddler.tags.length; t++)
				{
				var theTag = createTagButton(theTags,tiddler.tags[t],tiddler.title);
				insertSpacer(theTags);
				}
			}
		}
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return(theTag);
}

// Create the body section of an edittable tiddler
function createTiddlerEditor(title)
{
	var theBody = document.getElementById("body" + title);
	if(theBody)
		{
		var tiddlerText = store.getTiddlerText(title);
		var tiddlerExists = (tiddlerText != null);
		if(!tiddlerExists)
			tiddlerText = config.views.editor.defaultText.format([title]);
		var theEditor = createTiddlyElement(theBody,"div","editorWrapper" + title,"editor",null);
		theEditor.onkeypress = onEditKey;
		var theTitleBox = createTiddlyElement(theEditor,"input","editorTitle" + title,null,null);
		theTitleBox.setAttribute("type","text");
		theTitleBox.value = title;
		theTitleBox.setAttribute("size","40");
		var theBodyBox = createTiddlyElement(theEditor,"textarea","editorBody" + title,null,null);
		theBodyBox.value = tiddlerText;
		var rows = 10;
		var lines = tiddlerText.match(regexpNewLine);
		if(lines != null && lines.length > rows)
			rows = lines.length + 5;
		theBodyBox.setAttribute("rows",rows);
		var theTagsBox = createTiddlyElement(theEditor,"input","editorTags" + title,null,null);
		theTagsBox.setAttribute("type","text");
		var tiddler = store.tiddlers[title];
		theTagsBox.value = tiddler ? tiddler.getTags() : "";
		theTagsBox.setAttribute("size","40");
		var tagPrompt = createTiddlyElement(theEditor,"div",null,"editorFooter",config.views.editor.tagPrompt);
		insertSpacer(tagPrompt);
		var lingo = config.views.editor.tagChooser;
		var addTag = createTiddlyButton(tagPrompt,lingo.text,lingo.tooltip,onClickAddTag);
		addTag.setAttribute("tiddler",title);
		theBodyBox.focus();
		}
}

function saveTiddler(title)
{
	var titleBox = document.getElementById("editorTitle" + title);
	var newTitle = titleBox.value;
	if(store.tiddlers[newTitle])
		{
		if(newTitle != title && !confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
			{
			titleBox.focus();
			titleBox.select();
			return;
			}
		}
	var body = document.getElementById("editorBody" + title);
	var newBody = body.value;
	var newTags = document.getElementById("editorTags" + title).value;
	blurTiddler(title);
	store.saveTiddler(title,newTitle,newBody,config.options.txtUserName,new Date(),newTags);
	displayTiddler(null,newTitle,1,null,null,null,false,false);
	// Close the old tiddler if this is a rename
	if(title != newTitle)
		{
		var oldTiddler = document.getElementById("tiddler" + title);
		var newTiddler = document.getElementById("tiddler" + newTitle);
		oldTiddler.parentNode.replaceChild(newTiddler,oldTiddler);
		}
	if(config.options.chkAutoSave)
		saveChanges();
}

function selectTiddler(title)
{
	var e = document.getElementById("tiddler" + title);
	if(e != null)
		e.firstChild.className = "selectedTiddler";
}

function deselectTiddler(title)
{
	var e = document.getElementById("tiddler" + title);
	if(e != null)
		e.firstChild.className = "unselectedTiddler";
}

function blurTiddler(title)
{
	var body = document.getElementById("editorBody" + title);
	if(title)
		{
		body.focus();
		body.blur();
		}
}

function deleteTiddler(title)
{
	closeTiddler(title,false);
	store.removeTiddler(title);
	// Autosave
	if(config.options.chkAutoSave)
		saveChanges();
}

function closeTiddler(title,slowly)
{
	var tiddler = document.getElementById("tiddler" + title);
	if(tiddler != null)
		{
		scrubIds(tiddler);
		if(config.options.chkAnimate)
			anim.startAnimating(new Slider(tiddler,false,slowly,"all"));
		else
			tiddler.parentNode.removeChild(tiddler);
		}
}

function scrubIds(e)
{
	if(e.id)
		e.id = null;
	var children = e.childNodes;
	for(var t=0; t<children.length; t++)
		{
		var c = children[t];
		if(c.id)
			c.id = null;
		}
}

function closeAllTiddlers()
{
	clearMessage();
	var place = document.getElementById("tiddlerDisplay");
	var tiddler = place.firstChild;
	var nextTiddler;
	while(tiddler)
		{
		nextTiddler = tiddler.nextSibling;
		if(tiddler.id)
			if(tiddler.id.substr(0,7) == "tiddler")
				{
				var title = tiddler.id.substr(7);
				if(!document.getElementById("editorWrapper" + title))
					place.removeChild(tiddler);
				}
		tiddler = nextTiddler;
		}
}

// ---------------------------------------------------------------------------------
// Regular expression stuff
// ---------------------------------------------------------------------------------

var upperLetter = "[A-Z\u00c0-\u00de\u0150\u0170]";
var lowerLetter = "[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]";
var anyLetter = "[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]";
var anyDigit = "[0-9]";
var anyNumberChar = "[0-9\\.E]";
var wikiNamePattern = "(~?)((?:" + upperLetter + "+" + lowerLetter + "+" + upperLetter + anyLetter + "*)|(?:" + upperLetter + "{2,}" + lowerLetter + "+))";
var urlPattern = "((?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b))";
var explicitLinkPattern = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
var bracketNamePattern = "\\[\\[([^\\]]+)\\]\\]";

var wikiNamePatterns;
var wikiNameRegExp;
var structurePatterns;
var stylePatterns;
var tableRegExp;
var tableRowColRegExp;
var invalidPreWikiNamePattern;

function setupRegexp()
{
	// Table rows pattern
	var rowPattern = "^\\|([^\\n]*\\|)([fhc]?)$";
	tableRegExp = new RegExp(rowPattern,"mg");
	// Table columns pattern
	var elementPattern = "(?:(?:BGCOLOR|bgcolor)\\(([^\\)]+)\\):)?" +
		"("+
		"("+explicitLinkPattern+")?"+
		"("+bracketNamePattern+")?" +
		"[^\\|]*"+
		")\\|";
	tableRowColRegExp = new RegExp(elementPattern,"g");
	// Link patterns
	wikiNamePatterns = "(?:" + wikiNamePattern +
		")|(?:" + urlPattern +
		")|(?:" + explicitLinkPattern +
		")|(?:" + bracketNamePattern +
		")";
	wikiNameRegExp = new RegExp(wikiNamePatterns,"mg");
	invalidPreWikiNamePattern = anyLetter;
	// Structural patterns
	var breakPattern = "\\n";
	var horizontalRulePattern = "^----$\\n?";
	var headerPattern = "^!{1,5}";
	var bulletListItemPattern = "^\\*+";
	var numberedListItemPattern = "^#+";
	var tablePattern = "(?:^\\|[^\\n]*$\\n?)+";
	var blockquotePattern = "(?:^>[^\\n]*$\\n?)+";
	var blockquotePattern2 = "^<<<\\n((?:^(?!<<<)[^\\n]*\\n)+)(^<<<$\\n?)";
	var imagePattern = "\\[[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\]\\]";
	var verbatimPattern = "^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)";
	var macroPattern = "<<([^>\\s]+)(?:\\s*)([^>]*)>>";
	structurePatterns = "(" + breakPattern +
		")|(" + horizontalRulePattern +
		")|(" + headerPattern +
		")|(" + bulletListItemPattern +
		")|(" + numberedListItemPattern +
		")|(" + tablePattern +
		")|(" + blockquotePattern +
		")|(?:" + blockquotePattern2 +
		")|(?:" + imagePattern +
		")|(?:" + verbatimPattern +
		")|(?:" + macroPattern +
		")";
	// Style patterns
	var boldPattern = "''((?:[^']+(?:'[^'])?)+)''";
	var strikePattern = "==([^=]+)==";
	var underlinePattern = "__([^_]+)__";
	var italicPattern = "//([^/]+)//";
	var supPattern = "\\^\\^([^\\^]+)\\^\\^";
	var subPattern = "~~([^~]+)~~";
	var monoPattern = "\\{\\{\\{(.*?)\\}\\}\\}";
	var colorPattern = "@@(?:color\\(([^\\)]+)\\):|bgcolor\\(([^\\)]+)\\):){0,2}([^@]+)@@";
	stylePatterns = "(?:" + boldPattern +
		")|(?:" + strikePattern +
		")|(?:" + underlinePattern +
		")|(?:" + italicPattern +
		")|(?:" + supPattern +
		")|(?:" + subPattern +
		")|(?:" + colorPattern +
		")|(?:" + monoPattern +
		")";
}

// Create child text nodes and link elements to represent a wiki-fied version of some text
function wikify(text,parent,highlightText,highlightCaseSensitive)
{
	// Prepare the regexp for the highlighted selection
	if(highlightText == "")
		highlightText = null;
	var highlightRegExp,highlightMatch;
	if(highlightText)
		{
		highlightRegExp = new RegExp(highlightText,highlightCaseSensitive ? "mg" : "img");
		highlightMatch = highlightRegExp.exec(text);
		}
	wikifyStructures(parent,text,text,0,text.length,highlightRegExp,highlightMatch);
}


function wikifyStructures(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	var body = parent;
	var structureRegExp = new RegExp(structurePatterns,"mg");
	var theList = []; // theList[0]: don't use
	var isInListMode = false;
	var isInHeaderMode = false;
	var isNewline = false;
	// The start of the fragment of the text being considered
	var nextPos = 0;
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = structureRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Subwikify the plain text before the match
		if(nextPos < matchPos)
			{
			isNewline = false;
			highlightMatch = wikifyStyles(body,text,targetText.substring(nextPos,matchPos),startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
			}
		// Dump out the formatted match
		var level;
		var theBlockquote;
		if(formatMatch)
			{
			// Dump out the link itself in the appropriate format
			if(formatMatch[1])
				{
				if(isNewline && isInListMode)
					{
					theList = [];
					body = parent;
					isInListMode = false;
					}
				else if(isInHeaderMode)
					{
					body = parent;
					isInHeaderMode = false;
					}
				else
					{
					isNewline = true;
					body.appendChild(document.createElement("br"));
					}
				}
			else if(formatMatch[2])
				{
				isNewline = false;
				body.appendChild(document.createElement("hr"));
				}
			else if(formatMatch[3])
				{
				level = formatMatch[3].length;
				isNewline = false;
				isInHeaderMode = true;
				var theHeader = document.createElement("h" + level);
				parent.appendChild(theHeader);
				body = theHeader;
				}
			else if(formatMatch[4])
				{
				level = formatMatch[4].length;
				isNewline = false;
				isInListMode = true;
				if (theList[level] == null)
					{
					theList[level] = document.createElement("ul");
					body.appendChild(theList[level]);
					}
				theList = theList.slice(0,level + 1);
				body = document.createElement("li");
				theList[level].appendChild(body);
				}
			else if(formatMatch[5])
				{
				level = formatMatch[5].length;
				isNewline = false;
				isInListMode = true;
				if (theList[level] == null)
					{
					theList[level] = document.createElement("ol");
					body.appendChild(theList[level]);
					}
				theList = theList.slice(0,level + 1);
				body = document.createElement("li");
				theList[level].appendChild(body);
				}
			else if(formatMatch[6])
				{
				isNewline = false;
				highlightMatch = wikifyTable(body,text,formatMatch[6],startPos+matchPos,startPos+structureRegExp.lastIndex,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[7])
				{
				isNewline = false;
				var quotedText = formatMatch[7].replace(new RegExp("^>(>*)","mg"),"$1");
				theBlockquote = document.createElement("blockquote");
				var newHighlightRegExp,newHighlightMatch;
				if (highlightRegExp) {
					newHighlightRegExp = new RegExp(highlightRegExp.toString(), "img");
					newHighlightMatch = newHighlightRegExp.exec(quotedText);
				}
				wikifyStructures(theBlockquote,quotedText,quotedText,0,quotedText.length,newHighlightRegExp,newHighlightMatch);
				body.appendChild(theBlockquote);
				}
			else if(formatMatch[8])
				{
				isNewline = false;
				theBlockquote = document.createElement("blockquote");
				highlightMatch = wikifyStructures(theBlockquote,text,formatMatch[8],startPos+matchPos+4,startPos+structureRegExp.lastIndex-formatMatch[9].length,highlightRegExp,highlightMatch);
				body.appendChild(theBlockquote);
				}
			else if(formatMatch[11])
				{
				isNewline = false;
				var theImage = document.createElement("img");
				theImage.alt = formatMatch[10];
				theImage.src = formatMatch[11];
				body.appendChild(theImage);
				}
			else if(formatMatch[12])
				{
				isNewline = false;
				var theVerbatim = document.createElement("pre");
				out = text.substr(startPos+matchPos+4,startPos+structureRegExp.lastIndex-formatMatch[13].length-startPos-matchPos-4);
				out = out.replace(/\n/g,"\r\n");
				theVerbatim.appendChild(document.createTextNode(out));
				body.appendChild(theVerbatim);
				}
			else if(formatMatch[14])
				{
				isNewline = false;
				insertMacro(body,formatMatch[14],formatMatch[15]);
				}
			}
		// Move the next position past the formatting match
		nextPos = structureRegExp.lastIndex;
	} while(formatMatch);
	return highlightMatch;
}

function wikifyLinks(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	// The start of the fragment of the text being considered
	var nextPos = 0;
	// Loop through the bits of the body text
	var theLink;
	do {
		// Get the next formatting match
		var formatMatch = wikiNameRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Subwikify the plain text before the match
		if(nextPos < matchPos)
			highlightMatch = subWikify(parent,text,startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
		// Dump out the formatted match
		if(formatMatch)
			{
			// Dump out the link itself in the appropriate format
			if(formatMatch[2])
				{
				if(formatMatch[1])
					{
					theLink = parent;
					matchPos++;
					}
				else if(matchPos > 0 && new RegExp(invalidPreWikiNamePattern,"").exec(targetText.charAt(matchPos - 1)))
					theLink = parent;
				else
					theLink = createTiddlyLink(parent,formatMatch[2],false);
				highlightMatch = subWikify(theLink,text,startPos+matchPos,startPos+wikiNameRegExp.lastIndex,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[3])
				{
				theLink = createExternalLink(parent,formatMatch[3]);
				highlightMatch = subWikify(theLink,text,startPos+matchPos,startPos+wikiNameRegExp.lastIndex,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[4])
				{
				if(store.tiddlers[formatMatch[5]] != undefined)
					theLink = createTiddlyLink(parent,formatMatch[5],false);
				else
					theLink = createExternalLink(parent,formatMatch[5]);
				highlightMatch = subWikify(theLink,text,startPos+matchPos+2,startPos+matchPos+2+formatMatch[4].length,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[6])
				{
				theLink = createTiddlyLink(parent,formatMatch[6],false);
				highlightMatch = subWikify(theLink,text,startPos+matchPos+2,startPos+wikiNameRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			}
		// Move the next position past the formatting match
		nextPos = wikiNameRegExp.lastIndex;
	} while(formatMatch);
	return highlightMatch;
}

function wikifyStyles(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	var formatRegExp = new RegExp(stylePatterns,"mg");
	// The start of the fragment of the text being considered
	var nextPos = 0;
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = formatRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Subwikify the plain text before the match
		if(nextPos < matchPos)
			highlightMatch = wikifyLinks(parent,text,targetText.substring(nextPos,matchPos),startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
		// Dump out the formatted match
		if(formatMatch)
			{
			// Dump out the link itself in the appropriate format
			if(formatMatch[1])
				{
				var theBold = createTiddlyElement(parent,"b",null,null,null);
				highlightMatch = wikifyStyles(theBold,text,formatMatch[1],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[2])
				{
				var theStrike = createTiddlyElement(parent,"strike",null,null,null);
				highlightMatch = wikifyStyles(theStrike,text,formatMatch[2],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[3])
				{
				var theUnderline = createTiddlyElement(parent,"u",null,null,null);
				highlightMatch = wikifyStyles(theUnderline,text,formatMatch[3],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[4])
				{
				var theItalic = createTiddlyElement(parent,"i",null,null,null);
				highlightMatch = wikifyStyles(theItalic,text,formatMatch[4],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[5])
				{
				var theSup = createTiddlyElement(parent,"sup",null,null,null);
				highlightMatch = wikifyStyles(theSup,text,formatMatch[5],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[6])
				{
				var theSub = createTiddlyElement(parent,"sub",null,null,null);
				highlightMatch = wikifyStyles(theSub,text,formatMatch[6],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[9])
				{
				var theSpan;
				if ((formatMatch[7] == "" || formatMatch[7] == null) && (formatMatch[8] == "" || formatMatch[8] == null))
					{
					theSpan = createTiddlyElement(parent,"span",null,"marked",null);
					}
					else
					{
					theSpan = createTiddlyElement(parent,"span",null,null,null);
					if (formatMatch[7] != "") theSpan.style.color = formatMatch[7];
					if (formatMatch[8] != "") theSpan.style.background = formatMatch[8];
					}
				highlightMatch = wikifyStyles(theSpan,text,formatMatch[9],startPos+formatRegExp.lastIndex-2-formatMatch[9].length,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
				}
			else if(formatMatch[10])
				{
				var theCode = createTiddlyElement(parent,"code",null,null,null);
				highlightMatch = wikifyStyles(theCode,text,formatMatch[10],startPos+matchPos+3,startPos+formatRegExp.lastIndex-3,highlightRegExp,highlightMatch);
				}
			}
		// Move the next position past the formatting match
		nextPos = formatRegExp.lastIndex;
	} while(formatMatch);
	return highlightMatch;
}

// Create a table
function wikifyTable(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	// The start of the fragment of the text being considered
	var nextPos = 0;
	var theTable = document.createElement("table");
	var bodyRowLen = 0;
	var headRowLen = 0;
	var footRowLen = 0;
	var bodyRows = [];
	var headRows = [];
	var footRows = [];
	var theCaption = null;
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = tableRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		// Dump out the formatted match
		if(formatMatch) {
			if (formatMatch[2] == "c") {
				var cap = formatMatch[1].substring(0,formatMatch[1].length-1);
				theCaption = document.createElement("caption");
				highlightMatch = wikifyStyles(theCaption,text,cap,startPos+matchPos+1,startPos+cap.length,highlightRegExp,highlightMatch);
				if (bodyRowLen == 0 && headRowLen == 0 && footRowLen == 0) {
					theCaption.setAttribute("align", "top");
				} else {
					theCaption.setAttribute("align", "bottom");
				}
			} else if (formatMatch[2] == "h") {
				highlightMatch = wikifyTableRow(headRows,headRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
				headRowLen++;
			} else if (formatMatch[2] == "f") {
				highlightMatch = wikifyTableRow(footRows,footRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
				footRowLen++;
			} else {
				highlightMatch = wikifyTableRow(bodyRows,bodyRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
				bodyRowLen++;
			}
		}
		nextPos = tableRegExp.lastIndex;
	} while(formatMatch);

	if (theCaption != null) {
		theTable.appendChild(theCaption);
	}

	if (headRowLen > 0) {
		var theTableHead = document.createElement("thead");
		createTableRows(headRows,theTableHead);
		theTable.appendChild(theTableHead);
	}

	if (bodyRowLen > 0) {
		var theTableBody = document.createElement("tbody");
		createTableRows(bodyRows,theTableBody);
		theTable.appendChild(theTableBody);
	}

	if (footRowLen > 0) {
		var theTableFoot = document.createElement("tfoot");
		createTableRows(footRows,theTableFoot);
		theTable.appendChild(theTableFoot);
	}

	parent.appendChild(theTable);
	return highlightMatch;
}

function wikifyTableRow(rows,rowIndex,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
	// The start of the fragment of the text being considered
	var eIndex = 0;
	var elements = [];
	// Loop through the bits of the body text
	do {
		// Get the next formatting match
		var formatMatch = tableRowColRegExp.exec(targetText);
		var matchPos = formatMatch ? formatMatch.index : targetText.length;
		if(formatMatch) {
			var eText = formatMatch[2];
			if (eText == "~" || eText == ">") {
				elements[eIndex] = eText;
			} else {
				var eTextLen = eText.length;
				var align = "";
				if (eTextLen >= 1 && eText.charAt(0) == " ") {
					if (eTextLen >= 3 && eText.charAt(eTextLen - 1) == " ") {
						align = "center";
						eText = eText.substring(1,eTextLen - 1);
						//eTextLen -= 2;
						eTextLen--;
					} else {
						align = "right";
						eText = eText.substring(1);
						eTextLen--;
					}
				} else if (eTextLen >= 2 && eText.charAt(eTextLen - 1) == " ") {
					align = "left";
					eText = eText.substring(0,eTextLen - 1);
					//eTextLen--;
				}
				var theElement;
				if (eTextLen >= 1 && eText.charAt(0) == "!") {
					theElement = document.createElement("th");
					eText = eText.substring(1);
					eTextLen--;
				} else {
					theElement = document.createElement("td");
				}
				if (align != "") {
					theElement.align = align;
				}
				if (formatMatch[1]) {
					theElement.style.background = formatMatch[1];
				}
				highlightMatch = wikifyStyles(theElement,text,eText,startPos+tableRowColRegExp.lastIndex-eTextLen,startPos+tableRowColRegExp.lastIndex-1,highlightRegExp,highlightMatch);
				elements[eIndex] = theElement;
			}
			eIndex++;
		}
	} while(formatMatch);
	rows[rowIndex] = elements;
	return highlightMatch;
}

function createTableRows(rows,parent)
{
	var i, j, k, cols;
	for (i = 0; i < rows.length; i++) {
		cols = rows[i];
		var theRow = document.createElement("tr");
		for (j = 0; j < cols.length; j++) {
			if (cols[j] == "~") continue;
			var rowspan = 1;
			for (k = i+1; k < rows.length; k++) {
				if (rows[k][j] != "~") break;
				rowspan++;
			}
			var colspan = 1;
			for (; j < cols.length - 1; j++) {
				if (cols[j] != ">") break;
				colspan++;
			}
			var theElement = cols[j];
			if (rowspan > 1) {
				theElement.setAttribute("rowSpan",rowspan);
				theElement.setAttribute("rowspan",rowspan);
				theElement.valign = "center";
			}
			if (colspan > 1) {
				theElement.setAttribute("colSpan",colspan);
				theElement.setAttribute("colspan",colspan);
			}
			theRow.appendChild(theElement);
		}
		parent.appendChild(theRow);
	}
}

// Helper for wikify that handles highlights within runs of text
function subWikify(parent,text,startPos,endPos,highlightRegExp,highlightMatch)
{
	// Check for highlights
	while(highlightMatch && (highlightRegExp.lastIndex > startPos) && (highlightMatch.index < endPos) && (startPos < endPos))
		{
		// Deal with the plain text before the highlight
		if(highlightMatch.index > startPos)
			{
			parent.appendChild(document.createTextNode(text.substring(startPos,highlightMatch.index)));
			startPos = highlightMatch.index;
			}
		// Deal with the highlight
		var highlightEnd = Math.min(highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(parent,"span",null,"highlight",text.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		// Nudge along to the next highlight if we're done with this one
		if(startPos >= highlightRegExp.lastIndex)
			highlightMatch = highlightRegExp.exec(text);
		}
	// Do the unhighlighted text left over
	if(startPos < endPos)
		{
		parent.appendChild(document.createTextNode(text.substring(startPos,endPos)));
		//startPos = endPos;
		}
	return(highlightMatch);
}

// ---------------------------------------------------------------------------------
// Message area
// ---------------------------------------------------------------------------------

function displayMessage(text,linkText)
{
	var msgArea = document.getElementById("messageArea");
	var msg;
	if(linkText)
		{
		msg = createTiddlyElement(msgArea,"div",null,null,null);
		var link = createTiddlyElement(msg,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
		}
	else
		msg = createTiddlyElement(msgArea,"div",null,null,text);
	msgArea.style.display = "block";
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	removeChildren(msgArea);
	msgArea.style.display = "none";
}

// ---------------------------------------------------------------------------------
// Menu and sidebar functions
// ---------------------------------------------------------------------------------

function refreshStory(hint)
{
	var hits = hint ? store.getReferringTiddlers(hint) : null;
	var displayNodes = document.getElementById("tiddlerDisplay").childNodes;
	for(var t=0;t<displayNodes.length;t++)
		{
		var theId = displayNodes[t].id;
		if(theId && theId.substr(0,7) == "tiddler")
			{
			var title = theId.substr(7);
			if(hint)
				{
				var f = false;
				for(var h=0; h<hits.length; h++)
					if(hits[h].title == title)
						f = true
				if(f)
					refreshTiddler(title);
				}
			else
				refreshTiddler(title);
			}
		}
}

function refreshTabs(hint)
{
	refreshSpecialItem("sidebarTabs","SideBarTabs","SideBarTabs");
}

function refreshMenu(hint)
{
	refreshSpecialItem("mainMenu","MainMenu","MainMenu");
}

function refreshTitle(title)
{
	refreshSpecialItem("siteTitle",title,"SiteTitle");
	refreshPageTitle();
}

function refreshSubtitle(title)
{
	refreshSpecialItem("siteSubtitle",title,"SiteSubtitle");
	refreshPageTitle();
}

function refreshPageTitle()
{
	document.title = getElementText("siteTitle") + " - " + getElementText("siteSubtitle");
}

function refreshSidebar(title)
{
	refreshSpecialItem("sidebarOptions",title,"SideBarOptions");
}

function refreshSpecialItem(elementID,title,defaultText)
{
	var place = document.getElementById(elementID);
	removeChildren(place);
	wikify(store.getTiddlerText(title,defaultText),place,null,null);
}

function refreshStyles(title)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,""));
}

// ---------------------------------------------------------------------------------
// Options cookie stuff
// ---------------------------------------------------------------------------------

function loadOptionsCookie()
{
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++)
		{
		var p = cookies[c].indexOf("=");
		if(p != -1)
			{
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			switch(name.substr(0,3))
				{
				case "txt":
					config.options[name] = unescape(value);
					break;
				case "chk":
					config.options[name] = value == "true";
					break;
				}
			}
		}
}

function saveOptionCookie(name)
{
	var c = name + "=";
	switch(name.substr(0,3))
		{
		case "txt":
			c += escape(config.options[name].toString());
			break;
		case "chk":
			c += config.options[name] ? "true" : "false";
			break;
		}
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

// ---------------------------------------------------------------------------------
// Saving
// ---------------------------------------------------------------------------------

var saveUsingSafari = false;
var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// Check if there any unsaved changes before exitting
function checkUnsavedChanges()
{
	if(store.dirty)
		{
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
		}
}

// Save this tiddlywiki with the pending changes
function saveChanges()
{
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:")
		{
		alert(config.messages.notFileUrlError);
		displayTiddler(null,"SaveChanges",0,null,null,false,false);
		return;
		}
	// Remove any location part of the URL
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert to a native file format assuming
	// "file:///x:/path/path/path..." - pc local file --> "x:\path\path\path..."
	// "file://///server/share/path/path/path..." - FireFox pc network file --> "\\server\share\path\path\path..."
	// "file:///path/path/path..." - mac/unix local file --> "/path/path/path..."
	// "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	// Load the original file
	var original = loadFile(localPath);
	if(original == null)
		{
		alert(config.messages.cantSaveError);
		displayTiddler(null,"SaveChanges",0,null,null,false,false);
		return;
		}
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var posClosingDiv = original.lastIndexOf(endSaveArea);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([localPath]));
		return;
		}
	// Save the backup
	if(config.options.chkSaveBackups)
		{
		var backupPath = localPath.substr(0,localPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
		var backup = saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
		}
	// Save Rss
	if(config.options.chkGenerateAnRssFeed)
		{
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
		}
	// Save empty template
	if(config.options.chkSaveEmptyTemplate)
		{
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posOpeningDiv + startSaveArea.length) + convertUnicodeToUTF8(generateEmpty()) + original.substr(posClosingDiv);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
		}
	// Save new file
	var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + 
				convertUnicodeToUTF8(allTiddlersAsHtml()) + "\n\t\t" +
				original.substr(posClosingDiv);
	var newSiteTitle = store.getTiddlerText("SiteTitle","TiddlyWiki").htmlEncode();
	revised = revised.replace(new RegExp("<title>[^<]*</title>", "im"),"<title>"+ newSiteTitle +"</title>");
	var save = saveFile(localPath,revised);
	if(save)
		{
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
		}
	else
		alert(config.messages.mainFailed);
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl",null);
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title>" + store.getTiddlerText("SiteTitle","").htmlEncode() + "</title>");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + store.getTiddlerText("SiteSubtitle","").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

function generateEmpty()
{
	var systemTiddlers = store.getTaggedTiddlers("systemTiddlers");
	var savedTiddlers = [];
	for(var s=0;s<systemTiddlers.length;s++)
		savedTiddlers.push(systemTiddlers[s].saveToDiv());
	return savedTiddlers.join("\n");
}

function allTiddlersAsHtml()
{
	var savedTiddlers = [];
	var tiddlers = store.getTiddlers("modified");
	for (var t = 0; t < tiddlers.length; t++)
		savedTiddlers.push(tiddlers[t].saveToDiv());
	return savedTiddlers.join("\n");
}

// UTF-8 encoding rules:
// 0x0000 - 0x007F:	0xxxxxxx
// 0x0080 - 0x07FF:	110xxxxx 10xxxxxx
// 0x0800 - 0xFFFF:	1110xxxx 10xxxxxx 10xxxxxx

function convertUTF8ToUnicode(u)
{
	var s = "";
	var t = 0;
	var b1, b2, b3;
	while(t < u.length)
		{
		b1 = u.charCodeAt(t++);
		if(b1 < 0x80)
			s += String.fromCharCode(b1);
		else if(b1 < 0xE0)
			{
			b2 = u.charCodeAt(t++);
			s += String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			}
		else
			{
			b2 = u.charCodeAt(t++);
			b3 = u.charCodeAt(t++);
			s += String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			}
	}
	return(s);
}

function convertUnicodeToUTF8(s)
{
	if(saveUsingSafari)
		return s;
	else if(window.Components)
		return mozConvertUnicodeToUTF8(s);
	else
		return manualConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var u = [];
	for(var t=0;t<s.length;t++)
		{
		var c = s.charCodeAt(t);
		if(c <= 0x7F)
			u.push(String.fromCharCode(c));
		else
			u.push("&#" + c.toString() + ";");
		}
	return(u.join(""));
}

function mozConvertUnicodeToUTF8(s)
{
	netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
	var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
	converter.charset = "UTF-8";
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function saveFile(fileUrl, content)
{
	var r = null;
	if(saveUsingSafari)
		r = safariSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = mozillaSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = ieSaveFile(fileUrl, content);
	return(r);
}

function loadFile(fileUrl)
{
	var r = null;
	if(saveUsingSafari)
		r = safariLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to save\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to load\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,1);
	var content = file.ReadAll();
	file.Close();
	return(content);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				file.create(0, 0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file, 0x20 | 0x02, 00004,null);
			out.write(content, content.length);
			out.flush();
			out.close();
			return(true);
			}
		catch(e)
			{
			//alert("Exception while attempting to save\n\n" + e);
			return(false);
			}
	return(null);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				return(null);
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file, 0x01, 00004, null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return(sInputStream.read(sInputStream.available()));
			}
		catch(e)
			{
			//alert("Exception while attempting to load\n\n" + e);
			return(false);
			}
	return(null);
}

function safariFilenameToUrl(filename) {
	return ("file://" + filename);
}

function safariLoadFile(url)
{
	url = safariFilenameToUrl(url);
	var plugin = document.embeds["tiddlyWikiSafariSaver"];
	return plugin.readURL(url);
}

function safariSaveFile(url,content)
{
	url = safariFilenameToUrl(url);
	var plugin = document.embeds["tiddlyWikiSafariSaver"];
	return plugin.writeStringToURL(content,url);
}

// Lifted from http://developer.apple.com/internet/webcontent/detectplugins.html
function detectPlugin()
{
	var daPlugins = detectPlugin.arguments;
	var pluginFound = false;
	if (navigator.plugins && navigator.plugins.length > 0)
		{
		var pluginsArrayLength = navigator.plugins.length;
		for (pluginsArrayCounter=0; pluginsArrayCounter < pluginsArrayLength; pluginsArrayCounter++ )
			{
			var numFound = 0;
			for(namesCounter=0; namesCounter < daPlugins.length; namesCounter++)
				{
				if( (navigator.plugins[pluginsArrayCounter].name.indexOf(daPlugins[namesCounter]) >= 0) || 
						(navigator.plugins[pluginsArrayCounter].description.indexOf(daPlugins[namesCounter]) >= 0) )
					numFound++;
				}
			if(numFound == daPlugins.length)
				{
				pluginFound = true;
				break;
				}
			}
	}
	return pluginFound;
}

// ---------------------------------------------------------------------------------
// Event handlers
// ---------------------------------------------------------------------------------

function onEditKey(e)
{
	if (!e) var e = window.event;
	clearMessage();
	var consume = false;
	switch(e.keyCode)
		{
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey && this.id && this.id.substr(0,13) == "editorWrapper")
				{
				blurTiddler(this.id.substr(13));
				saveTiddler(this.id.substr(13));
				consume = true;
				}
			break;
		case 27: // Escape
			if(this.id && this.id.substr(0,13) == "editorWrapper")
				{
				blurTiddler(this.id.substr(13));
				displayTiddler(null,this.id.substr(13),1,null,null,false,false);
				consume = true;
				}
			break;
		}
	e.cancelBubble = consume;
	if(consume)
		if (e.stopPropagation) e.stopPropagation();
	return(!consume);

}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(title)
		{
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		var opening;
		if(toggling && document.getElementById("tiddler" + title))
			closeTiddler(title,e.shiftKey || e.altKey);
		else
			displayTiddler(theTarget,title,0,null,null,true,e.shiftKey || e.altKey);
		}
	clearMessage();
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for mouse over a tiddler
function onMouseOverTiddler(e)
{
	var tiddler;
	if(this.id.substr(0,7) == "tiddler")
		tiddler = this.id.substr(7);
	if(tiddler)
		selectTiddler(tiddler);
}

// Event handler for mouse out of a tiddler
function onMouseOutTiddler(e)
{
	var tiddler;
	if(this.id.substr(0,7) == "tiddler")
		tiddler = this.id.substr(7);
	if(tiddler)
		deselectTiddler(tiddler);
}

// Event handler for double click on a tiddler
function onDblClickTiddler(e)
{
	if(!readOnly)
		{
		clearMessage();
		if(document.selection)
			document.selection.empty();
		var tiddler;
		if(this.id.substr(0,7) == "tiddler")
			tiddler = this.id.substr(7);
		if(tiddler)
			displayTiddler(null,tiddler,2,null,null,false,false);
		}
}

// Event handler for clicking on toolbar close
function onClickToolbarClose(e)
{
	if (!e) var e = window.event;
	clearMessage();
	if(this.parentNode.id)
		closeTiddler(this.parentNode.id.substr(7),e.shiftKey || e.altKey);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on toolbar permalink
function onClickToolbarPermaLink(e)
{
	if(this.parentNode.id)
		{
		var title = this.parentNode.id.substr(7);
		var t = encodeURIComponent(String.encodeTiddlyLink(title));
		if(window.location.hash != t)
			window.location.hash = t;
		}
}

// Event handler for clicking on toolbar close
function onClickToolbarDelete(e)
{
	clearMessage();
	if(this.parentNode.id)
		deleteTiddler(this.parentNode.id.substr(7));
}

// Event handler for clicking on the toolbar references button
function onClickToolbarReferences(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = createTiddlerPopup(this);
	if(popup && this.parentNode.id)
		{
		var title = this.parentNode.id.substr(7);
		var references = store.getReferringTiddlers(title);
		var c = false;
		for(var r=0; r<references.length; r++)
			if(references[r].title != title)
				{
				createTiddlyLink(popup,references[r].title,true);
				c = true;
				}
		if(!c)
			popup.appendChild(document.createTextNode(config.views.wikified.toolbarReferences.popupNone));
		}
	scrollToTiddlerPopup(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on a tiddler tag
function onClickTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = createTiddlerPopup(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag)
		{
		var tagged = store.getTaggedTiddlers(tag);
		var c = false;
		for(var r=0;r<tagged.length;r++)
			if(tagged[r].title != title)
				{
				createTiddlyLink(popup,tagged[r].title,true);
				c = true;
				}
		var lingo = config.views.wikified.tag;
		if(c)
			{
			popup.insertBefore(document.createElement("hr"),popup.firstChild);
			var openAll = createTiddlyButton(null,lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			popup.insertBefore(openAll,popup.firstChild);
			}
		else
			popup.appendChild(document.createTextNode(lingo.popupNone.format([tag])));
		}
	scrollToTiddlerPopup(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(e)
{
	if (!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	for(var t=tagged.length-1; t>=0; t--)
		displayTiddler(this,tagged[t].title,0,null,null,false,e.shiftKey || e.altKey);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on the 'add tag' button
function onClickAddTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = createTiddlerPopup(this);
	var tiddler = this.getAttribute("tiddler");
	var tags = store.getTags();
	var lingo = config.views.editor.tagChooser;
	if(tags.length == 0)
		createTiddlyElement(popup,"div",null,null,lingo.popupNone);
	for (t=0; t<tags.length; t++)
		{
		var theTag = createTiddlyButton(popup,tags[t][0],lingo.tagTooltip.format([tags[t][0]]),onClickAddTagPopup);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler",tiddler);
		}
	scrollToTiddlerPopup(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on a tag in the 'add tag' popup
function onClickAddTagPopup(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var tiddler = this.getAttribute("tiddler");
	var tag = this.getAttribute("tag");
	var tagsBox = document.getElementById("editorTags" + tiddler);
	if(tagsBox)
		tagsBox.value += " " + String.encodeTiddlyLink(tag);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for clicking on toolbar close
function onClickToolbarEdit(e)
{
	clearMessage();
	if(this.parentNode.id)
		displayTiddler(null,this.parentNode.id.substr(7),2,null,null,false,false);
}

// Event handler for clicking on toolbar save
function onClickToolbarSave(e)
{
	if(this.parentNode.id)
		saveTiddler(this.parentNode.id.substr(7));
}

// Event handler for clicking on toolbar save
function onClickToolbarUndo(e)
{
	if(this.parentNode.id)
		displayTiddler(null,this.parentNode.id.substr(7),1,null,null,false,false);
}

// Eek... it's bad that this is done via a function rather than a normal, copy-able href
function onClickPermaView()
{
	var tiddlerDisplay = document.getElementById("tiddlerDisplay");
	var links = [];
	for(var t=0;t<tiddlerDisplay.childNodes.length;t++)
		{
		var tiddlerName = tiddlerDisplay.childNodes[t].id.substr(7);
		links.push(String.encodeTiddlyLink(tiddlerName));
		}
	window.location.hash = encodeURIComponent(links.join(" "));
}

// ---------------------------------------------------------------------------------
// Animation engine
// ---------------------------------------------------------------------------------

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0)
		{
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},25);
		}
	this.running += arguments.length;
}

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a<me.animations.length)
		{
		var animation = me.animations[a];
		animation.progress += animation.step;
		if(animation.progress < 0 || animation.progress > 1)
			{
			animation.stop();
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
			}
		else
			{
			animation.tick();
			a++;
			}
		}
}

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
}

// ---------------------------------------------------------------------------------
// Zoomer animation
// ---------------------------------------------------------------------------------

function Zoomer(text,startElement,targetElement,slowly)
{
	this.element = document.createElement("div");
	this.element.appendChild(document.createTextNode(text));
	this.element.className = "zoomer";
	document.body.appendChild(this.element);
	this.startElement = startElement;
	this.startLeft = findPosX(this.startElement);
	this.startTop = findPosY(this.startElement);
	this.startWidth = this.startElement.offsetWidth;
	this.startHeight = this.startElement.offsetHeight;
	this.targetElement = targetElement;
	this.targetLeft = findPosX(this.targetElement);
	this.targetTop = findPosY(this.targetElement);
	this.targetWidth = this.targetElement.offsetWidth;
	this.targetHeight = this.targetElement.offsetHeight;
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	this.targetElement.style.opacity = 0;
	return this;
}

Zoomer.prototype.stop = function()
{
	this.element.parentNode.removeChild(this.element);
	this.targetElement.style.opacity = 1;
}

Zoomer.prototype.tick = function()
{
	var f = Animator.slowInSlowOut(this.progress);
	this.element.style.left = this.startLeft + (this.targetLeft-this.startLeft) * f + "px";
	this.element.style.top = this.startTop + (this.targetTop-this.startTop) * f + "px";
	this.element.style.width = this.startWidth + (this.targetWidth-this.startWidth) * f + "px";
	this.element.style.height = this.startHeight + (this.targetHeight-this.startHeight) * f + "px";
	this.element.style.display = "block";
	this.targetElement.style.opacity = this.progress;
	this.targetElement.style.filter = "alpha(opacity:" + this.progress * 100 + ")";
}

// ---------------------------------------------------------------------------------
// Scroller animation
// ---------------------------------------------------------------------------------

function Scroller(targetElement,slowly)
{
	this.targetElement = targetElement;
	this.startScroll = findScrollY();
	this.targetScroll = ensureVisible(targetElement);
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	return this;
}

Scroller.prototype.stop = function()
{
	window.scrollTo(0,this.targetScroll);
}

Scroller.prototype.tick = function()
{
	var f = Animator.slowInSlowOut(this.progress);
	window.scrollTo(0,this.startScroll + (this.targetScroll-this.startScroll) * f);
}

// ---------------------------------------------------------------------------------
// Slider animation
// ---------------------------------------------------------------------------------

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,slowly,deleteMode)
{
	this.element = element;
	element.style.display = "block";
	this.deleteMode = deleteMode;
	this.element.style.height = "auto";
	this.realHeight = element.offsetHeight;
	this.opening = opening;
	this.step = slowly ? config.animSlow : config.animFast;
	if(opening)
		{
		this.progress = 0;
		element.style.height = "0px";
		element.style.display = "block";
		}
	else
		{
		this.progress = 1;
		this.step = -this.step;
		}
	element.style.overflow = "hidden";
	return this;
}

Slider.prototype.stop = function()
{
	if(this.opening)
		this.element.style.height = "auto";
	else
		{
		switch(this.deleteMode)
			{
			case "none":
				this.element.style.display = "none";
				break;
			case "all":
				this.element.parentNode.removeChild(this.element);
				break;
			case "children":
				removeChildren(this.element);
				break;
			}
		}
}

Slider.prototype.tick = function()
{
	var f = Animator.slowInSlowOut(this.progress);
	var h = this.realHeight * f;
	this.element.style.height = h + "px";
	this.element.style.opacity = f;
}

// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Number(), Array() and String() objects
// ---------------------------------------------------------------------------------

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
}

// Find an entry in an array. Returns the array index or null
Array.prototype.find = function(item)
{
	var p = null;
	for(var t=0; t<this.length; t++)
		if(this[t] == item)
			{
			p = t;
			break;
			}
	return p;
}

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique != undefined && unique == false)
		this.push(item);
	else
		{
		if(this.find(item) == null)
			this.push(item);
		}
}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	if(n < this.length)
		return this.slice(this.length-n);
	else
		return this;
}

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	var regexpTrim = new RegExp("^\\s*(.*)\\s*$","mg");
	return(this.replace(regexpTrim,"$1"));
}

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = new RegExp("(?:%(\\d+))","mg");
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1])
			{
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
			}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
}

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	return(this.replace(new RegExp("[\\\\\\^\\$\\*\\+\\?\\(\\)\\=\\!\\|\\,\\{\\}\\[\\]\\.]","g"),"\\$&"));
}

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	var regexpAmp = new RegExp("&","mg");
	var regexpLessThan = new RegExp("<","mg");
	var regexpGreaterThan = new RegExp(">","mg");
	var regexpQuote = new RegExp("\"","mg");
	return(this.replace(regexpAmp,"&amp;").replace(regexpLessThan,"&lt;").replace(regexpGreaterThan,"&gt;").replace(regexpQuote,"&quot;"));
}

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '', [[]] or left unquoted (and therefore space-separated)
String.prototype.readMacroParams = function()
{
	var regexpMacroParam = new RegExp("(?:\\s*)(?:(?:\"([^\"]*)\")|(?:'([^']*)')|(?:\\[\\[([^\\]]*)\\]\\])|([^\"'\\s]\\S*))","mg");
	var params = [];
	do {
		var match = regexpMacroParam.exec(this);
		if(match)
			{
			if(match[1]) // Double quoted
				params.push(match[1]);
			else if(match[2]) // Single quoted
				params.push(match[2]);
			else if(match[3]) // Double-square-bracket quoted
				params.push(match[3]);
			else if(match[4]) // Unquoted
				params.push(match[4]);
			}
	} while(match);
	return params;
}

// Process a string list of tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var bracketedPattern = "\\[\\[([^\\]]+)\\]\\]";
	var unbracketedPattern = "[^\\s$]+";
	var pattern = "(?:" + bracketedPattern + ")|(" + unbracketedPattern + ")";
	var re = new RegExp(pattern,"mg");
	var tiddlerNames = [];
	do {
		var match = re.exec(this);
		if(match)
			{
			if(match[1]) // Bracketed
				tiddlerNames.pushUnique(match[1],unique);
			else if(match[2]) // Unbracketed
				tiddlerNames.pushUnique(match[2],unique);
			}
	} while(match);
	return(tiddlerNames);
}

// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	if(title.indexOf(" ") == -1)
		return(title);
	else
		return("[[" + title + "]]");
}

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return(s);
}

// ---------------------------------------------------------------------------------
// RGB colour object
// ---------------------------------------------------------------------------------

// Construct an RGB colour object from a '#rrggbb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string")
		{
		if(r.substr(0,1) == "#")
			{
			this.r = parseInt(r.substr(1,2),16)/255;
			this.g = parseInt(r.substr(3,2),16)/255;
			this.b = parseInt(r.substr(5,2),16)/255;
			}
		else
			{
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/ ;
			var c = r.match(rgbPattern);
			if (c)
				{
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
				}
			}
		}
	else
		{
		this.r = r;
		this.g = g;
		this.b = b;
		}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
}

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var r = this.r.clamp(0,1);
	var g = this.g.clamp(0,1);
	var b = this.b.clamp(0,1);
	return("#" + ("0" + Math.floor(r * 255).toString(16)).right(2) +
				 ("0" + Math.floor(g * 255).toString(16)).right(2) +
				 ("0" + Math.floor(b * 255).toString(16)).right(2));
}

// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Date() object
// ---------------------------------------------------------------------------------

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	template = template.replace("YYYY",this.getFullYear());
	template = template.replace("YY",String.zeroPad(this.getFullYear()-2000,2));
	template = template.replace("MMM",config.messages.dates.months[this.getMonth()]);
	template = template.replace("0MM",String.zeroPad(this.getMonth()+1,2));
	template = template.replace("MM",this.getMonth()+1);
	template = template.replace("DDD",config.messages.dates.days[this.getDay()]);
	template = template.replace("0DD",String.zeroPad(this.getDate(),2));
	template = template.replace("DD",this.getDate());
	template = template.replace("hh",this.getHours());
	template = template.replace("mm",this.getMinutes());
	template = template.replace("ss",this.getSeconds());
	return template;
}

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2));
}

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + "." + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2) + String.zeroPad(this.getSeconds(),2) + String.zeroPad(this.getMilliseconds(),4));
}

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var theDate = new Date(parseInt(d.substr(0,4),10),
							parseInt(d.substr(4,2),10)-1,
							parseInt(d.substr(6,2),10),
							parseInt(d.substr(8,2),10),
							parseInt(d.substr(10,2),10),0,0);
	return(theDate);
}

// ---------------------------------------------------------------------------------
// DOM utilities - many derived from www.quirksmode.org 
// ---------------------------------------------------------------------------------

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return(e);
}

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId)
{
	var theButton = document.createElement("a");
	theButton.className = "button";
	if(theAction)
		{
		theButton.onclick = theAction;
		theButton.setAttribute("href","JavaScript:;");
		}
	theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	return(theButton);
}

function createTiddlyLink(place,title,includeText)
{
	var text = includeText ? title : null;
	var subTitle;
	var tiddler = store.tiddlers[title];
	if(tiddler)
		subTitle = tiddler.getSubtitle();
	else
		subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
	var theClass = tiddler ? "tiddlyLinkExisting tiddlyLink" : "tiddlyLinkNonExisting tiddlyLink";
	var btn = createTiddlyButton(place,text,subTitle,onClickTiddlerLink,theClass);
	btn.setAttribute("tiddlyLink",title);
	return(btn);
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return(theLink);
}

// Find the tiddler instance (if any) containing a specified element
function findContainingTiddler(e)
{
	if(e == null)
		return(null);
	do {
		if(e != document)
			{
			if(e.id)
				if(e.id.substr(0,7) == "tiddler")
					return(e);
			}
		e = e.parentNode;
	} while(e != document);
	return(null);
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if (e.target)
		obj = e.target;
	else if (e.srcElement)
		obj = e.srcElement;
	if (obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return(obj);
}

// Return the content of an element as plain text with no formatting
function getElementText(elementID)
{
	var e = document.getElementById(elementID);
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop)
		return(posTop);
	else if(posBot > winBot)
		{
		if(e.offsetHeight < winHeight)
			return(posTop - (winHeight - e.offsetHeight));
		else
			return(posTop);
		}
	else
		return(winTop);
}

// Get the current height of the display window
function findWindowHeight()
{
	return(window.innerHeight ? window.innerHeight : document.body.clientHeight);
}

// Get the current vertical page scroll position
function findScrollY()
{
	return(window.scrollY ? window.scrollY : document.body.scrollTop);
}

function findPosX(obj)
{
	var curleft = 0;
	while (obj.offsetParent)
		{
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
		}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while (obj.offsetParent)
		{
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
		}
	return curtop;
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e.hasChildNodes())
		e.removeChild(e.firstChild);
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id)
{
	if(!id)
		id = "customStyleSheet";
	var n = document.getElementById(id);
	if(document.createStyleSheet) // Test for IE's non-standard createStyleSheet method
		{
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		document.body.insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
		}
	else
		{
		if(n)
			n.replaceChild(document.createTextNode(s),n.firstChild);
		else
			{
			var n = document.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(document.createTextNode(s));
			document.getElementsByTagName("head")[0].appendChild(n);
			}
		}
}

// ---------------------------------------------------------------------------------
// End of scripts
// ---------------------------------------------------------------------------------

</script>
<style type="text/css" media="screen">
/* LAYOUT ELEMENTS ========================================================== */
*
{
	margin: 0;
	padding: 0;
}

body {
    background: #464646 repeat-x top fixed;
	color: #000;
    font: 13px/125% "Lucida Grande", "Trebuchet MS", "Bitstream Vera Sans", Verdana, Helvetica, sans-serif;
	_text-align: center;
}

#main_container
{
	margin: 0 auto;
	width: 775px;
	_width: 770px; /* CSS UNDERSCORE HACK FOR PROPER WIN/IE DISPLAY */
	_text-align: left; /* CSS UNDERSCORE HACK FOR PROPER WIN/IE DISPLAY */	
}

#header
{
	color: #fff;
	padding: 20px 20px 10px 0;
}

#side_container
{
	width: 215px;
	margin: 10px 10px 0 0;
	float: left;
	font-size: 12px;
}

#mainMenu {
    line-height: 166%;
	background: #600;
	border-right: 3px solid #500;
}

#sidebar {
    color: #000000;
}

#displayArea {
    float: left;
	width: 520px;
	_width: 545px; /* CSS UNDERSCORE HACK FOR PROPER WIN/IE DISPLAY */
}

a:link, a:visited, a:hover, a:active {
	text-decoration: none;
}


/* HEADER ========================================================== */

#siteTitle {
	font-size: 30px;
}

#siteSubtitle {
	font-size: 13px;
	padding-left: 10px;
}

#titleLine a {
    color: #cf6;
}

/* SIDEBARS ========================================================== */

#mainMenu a {
    color: #fff;
	background: #700;
	display: block;
	padding: 0 5px 0 10px;
	height: 22px;
	line-height: 22px;
	border-bottom: 1px solid #500;
	border-top: 1px solid #900;
}

#mainMenu a:hover {
    background: #b00;
}

#sidebarTabs {
    background: #960;
	border-right: 3px solid #740;
	border-bottom: 3px solid #520;
    padding: 0;
}

.tabset
{
	position: relative;
	top: -17px;
	padding: 0 0 5px 10px;
	border-bottom: 2px solid #960;
	_top: -21px;
}

.tabContents .tabset
{
	position: normal;
	top: 0;
	padding: 0;
	border: none;
}

.tabset a.tabSelected {
	background: #960;
}

.tabset a.tabUnselected {
	background: #660;
}

.tabContents .tabset a.tabSelected {
	background: #700;
}

.tabContents .tabset a.tabUnselected {
	background: #440;
}

.tabContents .tabContents
{
	background: #700;
}

.tabset a {
    color: #fff;
	padding: 2px 8px 2px 8px;
	margin: 0 2px 0 0;
	height: 22px;
	overflow: hidden;
}

.tabset a:hover {
    background: #000;
    color: #fff !important;
}

.tabset a:active {
    color: #000000;
}

#sidebarTabs a {
    color: #fff;
}

#sidebarTabs a:hover {
    background: #000;
    color: #fff;
}

#sidebarTabs a:active {
    color: #000000;
}

.tabContents{
    padding: 10px 10px 0 10px;
	font-size: 11px;
	clear: both;
	position: relative;
	top: -20px;
}

.tabContents .tabContents{
	position: normal;
	top: 0;
	padding-bottom: 10px;
}

.tabContents ul{
    margin: 0;
	padding: 0;
	list-style: none;
}

.tabContents .tabContents ul{
    color: #eeb;
}

.tabContents ul a {
    color: #fff;
	display: block;
	padding: 1px 0 1px 8px;
}

.tabContents ul a:hover {
    color: #fff;
    background: #000;
}

#licensePanel {
    padding: 0px 10px;
	font-size: 11px;
}

#licensePanel a {
    color: #960;
	display: block;
	margin-top: 10px;
}

#licensePanel a:hover {
    color: #fff;
}

#licensePanel a:active {
    color: #fff;
}

#sidebarOptions {
    background: #eeb;
	border-right: 3px solid #bb8;
    color: #B4C675;
	padding: 5px 0 25px 0;
}

#sidebarOptions a {
    color: #700;
	display: block;
	margin: 3px 10px;
}

#sidebarOptions a:hover, #sidebarOptions a:active {
    color: #fff;
    background: #700;
}

#sidebarOptions input {
    margin: 2px 10px;
    border: 1px inset #333;
}

a#save_button:link, a#save_button:visited
{
	line-height: 28px;
	height: 30px;
	width: 182px;
	margin: 10px;
	display: block;
	color: 000;
	background: #9c0 no-repeat;
	text-align: center;
}

a#save_button:hover, a#save_button:active
{
	color: #000;
	background: #9c0 left -44px no-repeat;
}

.save_accesskey
{
	visibility: hidden;
	position: fixed;
	_position: absolute;
	_top: 0px;
	_visibility: visible;
	_left: -999999px;
}

.sliderPanel {
    display: none;
    background: #fff;
    color: #000;
	padding: 5px 10px;
	font-size: 11px;
}

.sliderPanel input{
    display: inline !important;
	padding: 0 !important;
	margin: 0 !important;
}

.sliderPanel a{
    display: inline !important;
	padding: 0 !important;
	margin: 0 !important;
}

.sliderPanel a:link, .sliderPanel a:visited {
    color: #17b;
}

.sliderPanel a:hover, .sliderPanel a:active  {
    color: #fff;
    background: #000;
}

.optionsText {
    margin: 2px 0;
}

.optionsItem {
}

/* TIDDLER DISPLAY/EDIT SPACE ========================================================== */

.tiddler {
	margin: 0 0 10px 0;
	padding: 0 15px;
	border-right: 3px solid #aaa;
	border-bottom: 3px solid #555;
	background: #fff;
}

#messageArea
{
	font-size: 13px;
	padding: 5px;
	background: #FFE72F;
	border-right: 3px solid #da1;
	border-bottom: 3px solid #a80;
	text-align: center;
	display: none;
	position: fixed;
	top: 10px;
	right: 10px;
	_position: absolute;
}

#displayArea .tiddlyLinkExisting {
    font-weight: bold;
	text-decoration: none;
}

#displayArea .tiddlyLinkNonExisting {
    font-style: italic;
	text-decoration: none;
}

#displayArea .externalLink {
    text-decoration: underline;
}

.title {
    font-size: 1.5em;
	padding: 0 0 0 0;
    font-weight: bold;
    display: block;
	color: #900;
}

.toolbar {
    font-weight: normal;
    font-size: 11px;
    visibility: hidden;
	text-align: right;
	padding: 5px 0;
}

.selectedTiddler .toolbar {
	visibility: visible;
}

.toolbar a {
    padding: 1px 5px;
    color: #000;
	text-decoration: none;
	border: 1px outset #cf6;
	background: #cf6;
}

.toolbar a:hover {
    background: #ef9;
}

.toolbar a:active {
    background: #ff0;
}

.viewer {
    line-height: 140%;
}

.viewer a:link, .body a:visited {
    color: #15b;
	text-decoration: underline;
}

.viewer a:hover {
    color: #fff;
    background: #000;
}

.viewer blockquote {
    border-left: 3px solid #777;
	margin: 5px;
	padding: 5px;
}

.viewer ul {
	padding-left: 30px;
}

.viewer ol {
    padding-left: 30px;
}

ol
{ 
	list-style-type: decimal;
}

ol ol
{ 
	list-style-type: lower-alpha;
}

ol ol ol
{ 
	list-style-type: lower-roman;
}

.viewer ul, .viewer ol, .viewer p {
    margin: 5px 0 12px 0;
}

.viewer li {
    margin: 3px 0;
}

.viewer h1,h2,h3,h4,h5,h6 {
    font-weight: bold;
    background: #eee;
    padding: 2px 10px;
	margin: 5px 0;
}

.viewer h1 {
    font-size: 1.3em;
}

.viewer h2 {
    font-size: 1.2em;
}

.viewer h3 {
    font-size: 1.1em;
}

.viewer h4 {
    font-size: 1em;
}

.viewer h5 {
    font-size: .9em;
}

.viewer h6 {
    font-size: .8em;
}

.viewer table {
    border-collapse: collapse;
    border: 2px solid #303030;
	font-size: 11px;
	margin: 10px 0;
}

.viewer th {
    background: #eee;
    border: 1px solid #aaa;
    padding: 3px;
}

.viewer td {
    border: 1px solid #aaa;
    padding: 3px;
}

.viewer caption {
    padding: 3px;
}

.viewer hr {
    border: none;
    border-top: dotted 1px #777;
    height: 1px;
    color: #777;
	margin: 7px 0;
}

.body
{
 margin: 5px 0 0 0;
 padding: 5px 0;
 border-top: 1px solid #ccc;
}

.highlight {
    color: #000;
    background: #ffe72f;
}

.editor {
    font-size: 8pt;
    color: #402C74;
    font-weight: normal;
	padding: 10px 0;
}

.editor input, .editor textarea {
    display: block;
	font: 13px/130% "Andale Mono", "Monaco", "Lucida Console", "Courier New", monospace;
	margin: 0 0 10px 0;
    border: 1px inset #333;
	padding: 2px 0;
}

.editor textarea {
	height: 500px;
	width: 100%;
}

input:focus, textarea:focus
{
	background: #ffe;
	border: 1px solid #000 !important;
}

#storeArea, #copyright, .site_description, #saveTest {
    display: none;
}

#floater {
    background: #DF9;
	border: 3px solid #999;
	color: #DF9;
    position: absolute;
	left: -99999999px;
	top: -99999999px;
	width: 1px;
    opacity: 0.5;
    filter: alpha(opacity=50);
	display: none;
}

.footer
{
	padding: 5px 0;
	margin: 5px 0;
	border-top: 1px solid #ddd;
	color: #555;
	text-align: center;	
}

.footer div
{
	display: inline;
}


</style>
<style type="text/css" media="print">
/* LAYOUT ELEMENTS ========================================================== */
*
{
	margin: 0;
	padding: 0;
}

body {
    background: #fff;
	color: #000;
    font-size: 6.2pt;
	font-family: "Lucida Grande", "Bitstream Vera Sans", Helvetica, Verdana, Arial, sans-serif;
}

img {
	max-width: 2.2in;
	max-height: 4.3in;
}

#header, #side_container, #storeArea, #copyright, #floater, #messageArea, .save_accesskey, .site_description, #saveTest, .toolbar, .footer
{
	display: none;
}

#tiddlerDisplay, #displayArea
{
	display: inline;
}

.tiddler {
	margin: 0 0 2em 0;
	border-top: 1px solid #000;
	page-break-before: always;
}

.tiddler:first-child {
	page-break-before: avoid;
}

.title {
    font-size: 1.6em;
    font-weight: bold;
	margin-bottom: .3em;
	padding: .2em 0;
	border-bottom: 1px dotted #000;
}

p, blockquote, ul, li, ol, dt, dd, dl, table
{
	margin: 0 0 .3em 0;
}

h1, h2, h3, h4, h5, h6
{
	margin: .2em 0;
}  

h1
{
	font-size: 1.5em;
}

h2
{
	font-size: 1.3em;
}

h3
{
	font-size: 1.25em;
}

h4
{
	font-size: 1.15em;
}

h5
{
	font-size: 1.1em;
}

blockquote
{
	margin: .6em;
	padding-left: .6em;
	border-left: 1px solid #ccc;
}

ul
{
	list-style-type: circle;
}

li
{
	margin: .1em 0 .1em 2em;
	line-height: 1.4em;	
}

table
{
    border-collapse: collapse;
	font-size: 1em;
}

td, th
{
	border: 1px solid #999;
	padding: .2em;
}

hr {
    border: none;
    border-top: dotted 1px #777;
    height: 1px;
    color: #777;
	margin: .6em 0;
}
</style>

</noscript>
</head>
<body onLoad="main();" onUnload="checkUnsavedChanges();">
<div class="site_description">
<h1>GTD Tiddly Wiki is a GettingThingsDone adaptation by NathanBowers of JeremyRuston's Open Source TiddlyWiki</h1>
<p>The purpose of GTD Tiddly Wiki is to give users a single repository for their GTD lists and support materials so they can create/edit lists, and then print directly to 3x5 cards for use with the HipsterPDA.</p>
</div>
	<script>
	if (detectPlugin("TiddlyWiki Saver"))
		{
		document.write('<embed style="display: none" name="tiddlyWikiSafariSaver" width="0" height="0" type="application/x-webkit-tiddlywiki-saver"></embed>'); 
		saveUsingSafari = true;
		}
	</script>
<div id="main_container">
	<div id="copyright">
	Welcome to TiddlyWiki by Jeremy Ruston, Copyright &copy; 2005 Osmosoft Limited
	</div>
	<noscript>
		<div id="javascriptWarning">This page requires JavaScript to function properly</div>
	</noscript>
	<div id="saveTest"></div>
	<div id="contentWrapper">
		<div id="header">
			<div id="titleLine">
				<span id="siteTitle"></span>
				<span id="siteSubtitle"></span>
			</div>
		</div>
	<div id="side_container">
		<div id="mainMenu"></div>
		<div id="sidebar">
			<div id="sidebarOptions"></div>
			<div id="sidebarTabs"></div>
			<div id="licensePanel">
				<a rel="license" href="http://shared.snapgrid.com/gtd_tiddlywiki.html#RevisionHistory" target="_new">
					GTDTW Version 1.0.6
				</a>
				<a rel="license" href="http://www.tiddlywiki.com" target="_new">
					TiddlyWiki is published by Jeremy Ruston at Osmosoft under a BSD open source license
				</a>
				<a rel="license" href="http://snapgrid.com" target="_new">
					GTD TiddlyWiki is a modification by Nathan Bowers at Snapgrid under the same license terms.
				</a>
				<a rel="license" href="http://davidco.com" target="_new">
					"Getting Things Done" is &#169; David Allen at Davidco. Davidco has no affiliation with TiddlyWiki or GTD TiddlyWiki.
				</a>
			</div>
		</div>
	</div>
		<div id="displayArea">
			<div id="messageArea"></div>
			<div id="tiddlerDisplay"></div>
		</div>
	</div>
</div>
	
	   <div id="storeArea"><div tiddler="SiteSubtitle" modified="200512071123" modifier="TableSmith" tags="">Help and documentation for TableSmith</div>
<div tiddler="TableSmith" modified="200512071124" modifier="TableSmith" tags="">TableSmith is a Windows program intended to aid RPG Gamemasters by providing an easy-to-use system for creating and using tables and charts for their campaigns.\n</div>
<div tiddler="DefaultTiddlers" modified="200512071124" modifier="TableSmith" tags="">[[Help Topics]]</div>
<div tiddler="Favorites" modified="200512071718" modifier="TableSmith" tags="">The lower left of the window constitutes TableSmith's &quot;Favorites&quot; list. The purpose of the list is to allow you easy access to Tables you use often (similar to how such lists work elsewhere in Windows). Whereas the Tables in the Table listbox change based on the Category selected, the Tables listed in Favorites remain the same.\n\nTo assign a Table to Favorites, simply click &quot;Add&quot; and the current Table will be appended to the list. To remove a Table, click the &quot;Remove&quot; button when a Table is selected. \n\nTo run a Table in the list, just click on its name.</div>
<div tiddler="Dice" modified="200512081122" modifier="TableSmith" tags="">!!!Format\n{Dice~~XdY?Z}\n\n!!!Description\nGenerates a random number based on the formula &quot;~XdY?Z&quot;:\n\nX: Number of dice to roll. Must be a non-decimal number.\nd: Required. Think of it as the &quot;d&quot; in something like &quot;2d8&quot;.\nY: The number of &quot;sides&quot; of the dice you are rolling.\n?: Optional; one of the following: +, -, *, or /\nZ: Optional; amount to add/subtract/etc. based on &quot;?&quot;\n\n''Note:'' Probability and curves will be maintained by the Dice function. For instance, rolling &quot;3d6&quot; will generate a random number from 3-18. But the function does not simply generate a number in that range; rather, it generates a number from 1-6 three times and then sums the results. So the results of &quot;3d6&quot; would follow a bell curve rather than a straight line.\n\n!!!Examples\n{Dice~3d6} will &quot;roll&quot; 3d6 and return a number from 3-18\n\n{Dice~1d20+3} will &quot;roll&quot; 1d20 and add 3 (range: 4-23)\n\n{Dice~5d4*2} will &quot;roll&quot; 5d4 and multiply by 6 (range: 10-40)</div>
<div tiddler="Registration" modified="200512081123" modifier="TableSmith" tags="">TableSmith is shareware. If you wish to register TableSmith, contact Bruce Gulke (akira@mythosa.net) for current address information (or you can register via ~PayPal - www.paypal.com). Registration costs $10 (though you can pay more if you wish), and will encourage further development of TableSmith and other helpful utilities. \n</div>
<div tiddler="TableSmith Categories" modified="200512081127" modifier="TableSmith" tags="">TableSmith uses &quot;categories&quot; to help you organize your tables. A category is simply a folder you create in your &quot;Tables&quot; folder. The Category List on the main interface will display the folders in &quot;Tables&quot;, and selecting one will display the table files in that folder.\n\nSome things to keep in mind:\n* Though you can have tables with the same names in different categories/folders, you are encouraged to use unique names for all your tables. At present, TableSmith has no way of distinguishing two tables with the same name (and thus can generate unexpected results).\n* If a category/folder starts with a &quot;~&quot; character, it will not be displayed in the interface's drop-down list. Tables in that folder //will// still be seen by TableSmith. Use this feature if you have tables that you don't want to see in the interface but which other tables may use (such as reference tables).</div>
<div tiddler="Comments" modified="200512081422" modifier="TableSmith" tags="">!!!Comments\nThe first line, with the '#' character, is a comment. Comments may be placed anywhere within your table, generally to explain why something was done in a table in a particular way, to describe the table's purpose, to show who authored the table or where it's original source was, etc. Comments are intended for use by a person looking at a table; if a line has a '#' as its first character, the entire line is ignored by TableSmith.</div>
<div tiddler="Group Calls" modified="200512081454" modifier="TableSmith" tags="">Whenever an entry line contains something in double square brackets (&quot;[&quot; and &quot;]&quot;), rather than using that text as part of the selected line, the program will jump to the group with the name that is between the brackets, and insert the generated result from that group into the current line. For instance, in the example, the &quot;Creature&quot; group has an entry that says &quot;9,[Color] Spirit&quot;. This means that if that entry is selected, TableSmith will jump to the &quot;Color&quot; group, make a selection, and replace &quot;[Color]&quot; with that selection. Thus, the result would be &quot;Red Spirit&quot;, &quot;White Spirit&quot;, or &quot;Blue Spirit&quot;, depending on the value generated for the &quot;Color&quot; group.\n\n!!!Calling Groups in Other Tables\nBesides calling groups in the same table, you may also call group in other tables. If the text between the two brackets contains a period, TableSmith treats the text before the period as a table, and the text after it as a group. So while [Treasure] means the program will look in the current table for a group called &quot;Treasure&quot;, [Treasure.Coins] means the program would load the &quot;Treasure&quot; table and generate a result from that table's &quot;Coins&quot; group.\n\nIf you wish to generate a result from the entire table, reference the &quot;Start&quot; group (for instance, to generate a result from a table called &quot;Weapons&quot; as if you were selecting it directly through the TableSmith interface, the syntax would be [Weapons.Start]).\n\n''Note:'' Referenced tables must exist in the Tables subdirectory, and must be spelled the same as the table files (without the &quot;.tab&quot; extension).\n\nAlso note that with both types of Group Calls, it is possible to create endless loops that will freeze up the program (example: Having a table called &quot;Freeze&quot;, with one entry in the &quot;Start&quot; group, being &quot;1,[Start]&quot;). Due to the complexities involved, TableSmith does not check for this. You will have to be careful about this sort of thing.\n\n!!!Roll Modifiers\nNormally, when a group is called, TableSmith generates a random number within the range of the group's limits, and then looks up the corresponding entry for that number. For example: In the sample table, when TableSmith rolls on the &quot;Creature&quot; table, it generates a random number from 1 to 9, and selects the corresponding entry. However, you may modify this roll if you wish. When a group call is made, a &quot;roll modifier&quot; may be applied: If a group call contains a &quot;+&quot; or &quot;-&quot;, the value of whatever follows is either added to or subtracted from the roll made on the referenced group. If the call contains &quot;=&quot; then a roll isn't made; the call is &quot;forced&quot; to use the given number. For example:\n\n''[Potions+3]''\nThis would add 3 to the roll made on the group &quot;Potions&quot;\n\n''[Castles-5]''\nThis would subtract 5 from the roll made on the group &quot;Castles&quot;.\n\n''[Undead=4]''\nRather than roll on the group &quot;Undead&quot;, the result generated will be for whatever line the value 4 would return.\n\nA modifier is never required, and is simply used if you wish to modify a group roll.</div>
<div tiddler="Other Notes" modified="200512081505" modifier="TableSmith" tags="">A few other notes:\n\n* Tables are all in standard ASCII text format.\n* Table names, like group names, should not contain the following characters: &quot;+&quot;, &quot;-&quot;, and &quot;=&quot;.\n* TableSmith is case-sensitive when it comes to group names/calls as well as [[Variables]] (which are covered in the &quot;Advanced&quot; section of Help). Thus, the calls [Creature] and [creature] are //not// the same.\n* Any new tables must be added/copied/whatever into a folder in the &quot;Tables&quot; subdirectory, which is found in the directory that TableSmith was installed into.\n* TableSmith uses an HTML control for display, so you may place HTML tags into your entry lines for special formatting. For an example of how HTML is used in a table, look at the &quot;Book Description&quot; table.</div>
<div tiddler="Basic File Format" modified="200512081508" modifier="TableSmith" tags="">Table files are the heart of TableSmith. These are the tables that contain the rules and data used to generate names, treasure hoards, ~NPCs, village shops, encounters, and anything else you can think of. The information below covers the basics of TableSmith tables, and is enough to help you figure out how to edit existing tables or create new ones of your own. When you're comfortable with the basic functionality described below, you can move on to [[Advanced TableSmith Scripting]] and add even more power and flexibility to your tables.\n\n!!! Sample table\n\nA simple table is shown below and will serve as an example for the explanations that follow.\n\n # Sample table\n\n :Start\n 1,You see a [Creature] with a [Treasure.Coins], worth {Dice~1d6*1000} experience.\n\n :Creature\n 1-2,Orc\n 3,Skeleton\n 4-7,Archdaemon\n 8,[Goblins.Start]\n 9,[Color] Spirit\n\n # Colors for the various spirits\n :Color\n 1,Red\n 2-3,White\n 4,Blue\n\nThe example above illustrates several basic TableSmith concepts:\n[[Comments]]\n[[Groups]]\n[[Group Calls]]\n[[Dice Function]]\n\n!!!How does this all work?\nWhen TableSmith generates results for a table, it first goes to that table's &quot;Start&quot; group. Taking the total range of numbers based on the entries, it generates a random number, and matches it up with the appropriate entry. It then builds a string of text, calling various groups, tables, and die rolls as needed. This text is then displayed as the results of the table generation.\n\nHere's an example using the sample table above:\n\n* The program looks at the &quot;Start&quot; group and determines a range of numbers. Since there is one entry with a value of &quot;1&quot;, this range is 1-1 (pretty simple). A random number is generated in the range of 1 to 1, and strangely enough, &quot;1&quot; is the result.\n\n* Looking at the selected entry in &quot;Start&quot;, the program sees that a call is made to the group &quot;Creature&quot;. A range is again determined, this time being 1 to 9. A random number is generated in this range, and the result, say, is &quot;9&quot;.\n\n* If the result was &quot;2&quot;, &quot;Orc&quot; would have been the result of the call to &quot;Creature&quot;, and that would have been passed back to the &quot;Start&quot; entry. However, with &quot;9&quot;, there is a call to another group, &quot;Color&quot;.\n\n* TableSmith goes to the &quot;Color&quot; group, determines a range of 1 to 4, and generates a random value. &quot;4&quot; is the result, so &quot;Blue&quot; is passed back up.\n\n* &quot;Blue&quot; has been generated as a result for the call to the &quot;Color&quot; group, so this is substituted for &quot;[Color]&quot;, meaning the call to the &quot;Creature&quot; group has come up with &quot;Blue Spirit&quot;.\n\n* &quot;Blue Spirit&quot; is passed up to the &quot;Start&quot; entry, which uses it to replace &quot;[Creature]&quot;.\n\n* So far we have &quot;You see a Blue Spirit&quot;. To this we continue to add text, resulting in &quot;You see a Blue Spirit with a &quot; - but now we have another link, this time to another table called &quot;Treasure&quot; and one of its groups, &quot;Coins&quot;.\n\n* TableSmith loads the &quot;Treasure&quot; table and generates a result from its &quot;Coins&quot; group. Let's say we got back &quot;pouch of 20 gold&quot;; we continue, so before that first curly bracket, we have &quot;You see a Blue Spirit with a pouch of 20 gold, worth &quot;.\n\n* TableSmith looks at the dice roll &quot;1d6*1000&quot;, and generates a number from 1 to 6, multiplying it by 1000. Let's say the result is &quot;4000&quot;.\n\n* The final outcome of this generation is: &quot;You see a Blue Spirit with a pouch of 20 gold, worth 4000 experience.&quot;\n\n!!! Miscellaneous\nThis is just an example of what TableSmith does. The best way to learn the potential of this program is to look at the sample tables provided.\n\n[[Other Notes]]</div>
<div tiddler="Background Color" modified="200512121006" modifier="TableSmith" tags="">!!!Format\n/~BackColor nnnnn\n\n!!!Description\nIf the output is for HTML, the background color will be set to &quot;nnnnn&quot;. This color can be any color or format that the HTML Body attribute &quot;bgcolor&quot; recognizes.\n\n!!!Example\n/~BackColor green\n\nThis will display a green background in an HTML results display.\n</div>
<div tiddler="Override Number of Rolls" modified="200512121012" modifier="TableSmith" tags="">!!!Format\n/~OverrideRolls x\n\n!!!Description\nGenerates results from the table &quot;x&quot; number of times, rather than what is shown on the interface.\n\nThis directive may be useful if you have a table that is very involved and takes a while to generate a result. You may want to make sure you don't run it too many times if you forget to change the &quot;number of rolls&quot; in the interface. \n\n!!!Example\n/~OverrideRolls 3\n\nThis will always roll on the selected table three times regardless of what the TableSmith interface is indicating.</div>
<div tiddler="Parameters" modified="200512121127" modifier="TableSmith" tags="">TableSmith supports &quot;parameters.&quot; Parameters allow you to pass values from one table to another, or query a user for input before rolling on a table.\n\n[[Parameter Types]]\n[[Passing Parameters to Tables]]</div>
<div tiddler="Passing Parameters to Tables" modified="200512121244" modifier="TableSmith" tags="">Parameters may be passed to tables in group calls. You don't have to, nor do you have to pass a value for each parameter. To pass parameters, you use parentheses after the table call, like so:\n\n@@color(darkgreen):1,[~CharGen.Start(3,4)]@@\n\nIn this example, the ~CharGen table is called, with 3 and 4 being passed in. Before the &quot;Start&quot; group of ~CharGen is called, the value 3 will be assigned to its first parameter (call it &quot;G&quot;) and the value 4 will be assigned to its second parameter (dubbed &quot;C&quot;). Since the table is being called from //another table// rather than TableSmith itself, the prompts are not used.\n\nYou don't need to pass in a value for each parameters. The following all work in TableSmith (using the previous example):\n\n1,[~CharGen.Start(3,)] //(G=3, C=default)//\n1,[~CharGen.Start(,4)] //(G=default, C=4)//\n1,[~CharGen.Start(,)] //(G and C default)//\n1,[~CharGen.Start] //(G and C default)//\n</div>
<div tiddler="Abs" modified="200512121459" modifier="TableSmith" tags="">!!!Format\n{Abs~Value}\n\n!!!Description\nReturns the absolute value of &quot;Value&quot;.\n\n!!!Example\n{Abs~-3} returns &quot;3&quot;</div>
<div tiddler="Version" modified="200512121500" modifier="TableSmith" tags="">!!!Format\n{Version~}\n\n!!!Description\nReturns the version of the TableSmith engine.</div>
<div tiddler="VowelStart" modified="200512121501" modifier="TableSmith" tags="">!!!Format\n{~VowelStart~Text}\n\n!!!Description\nIf &quot;Text&quot; starts with a vowel (A, E, I, O, or U), this function returns a 1; otherwise, it returns a 0.\n\n!!!Example\n{~VowelStart~%var1%} returns &quot;1&quot; if var1 starts with a, e, i, o, or u; if var1 starts with a consonant, it returns a &quot;0&quot;.</div>
<div tiddler="CarRet" modified="200512121503" modifier="TableSmith" tags="">!!!Format\n{~CarRet~} or {CR~}\n\n!!!Description\nInserts a carriage return (i.e.; terminates the current of text and starts a new line). In HTML terms, &quot;&lt;br /&gt;&quot; replaces &quot;{~CarRet~}&quot;.</div>
<div tiddler="Ceil" modified="200512121504" modifier="TableSmith" tags="">!!!Format\n{Ceil~Value}\n\n!!!Description\nReturns the smallest integer higher than or equal to &quot;Value&quot;.\n\n!!!Example\n{Ceil~2} returns 2, {Ceil~1.3} returns 2, {Ceil~-2.3} returns -2.</div>
<div tiddler="LCase" modified="200512121505" modifier="TableSmith" tags="">!!!Format\n{~LCase~Text}\n\n!!!Description\nReturns &quot;Text&quot; in all lower case.\n\n!!!Example\n{~LCase~~TableSmith} will return &quot;tablesmith&quot;.</div>
<div tiddler="Length" modified="200512121508" modifier="TableSmith" tags="">!!!Format\n{Length~Text}\n\n!!!Description\nReturns the length of &quot;Text&quot;.\n\n!!!Example\n{Length~~TableSmith} will return &quot;10&quot;</div>
<div tiddler="Left" modified="200512121508" modifier="TableSmith" tags="">!!!Format\n{Left~X,Text}\n\n!!!Description\nReturns the X leftmost characters from &quot;Text&quot;.\n\n!!!Example\n{Left~3,~TableSmith} will return &quot;Tab&quot;.</div>
<div tiddler="UCase" modified="200512121509" modifier="TableSmith" tags="">!!!Format\n{~UCase~Text}\n\n!!!Description\nReturns &quot;Text&quot; in all upper case.\n\n!!!Example\n{~UCase~~TableSmith} will return &quot;TABLESMITH&quot;.</div>
<div tiddler="Trunc" modified="200512121510" modifier="TableSmith" tags="">!!!Format\n{Trunc~Value}\n\n!!!Description\nReturns the result of truncating &quot;Value&quot; (drops the fractional portion, if any).\n\n!!!Example\n{Trunc~3.5738472} returns &quot;3&quot;</div>
<div tiddler="Trim" modified="200512121512" modifier="TableSmith" tags="">!!!Format\n{Trim~Text}\n\n!!!Description\nTrims the spaces from the beginning and end of &quot;Text&quot; (spaces in the middle, surrounded by other characters, are unaffected).\n\n!!!Example\n{Trim~ a castle } returns &quot;a castle&quot;.</div>
<div tiddler="Cap" modified="200512121514" modifier="TableSmith" tags="">!!!Format\n{Cap~Text}\n\n!!!Description\nThis function will return &quot;Text&quot; with the first character capitalized. Spaces are counted, so while &quot;arrow&quot; will be capitalized to &quot;Arrow&quot;, &quot; arrow&quot; would stay the same, since the function considers the space part of the word.\n\n!!!Example\n{Cap~dragons} returns &quot;Dragons&quot;.</div>
<div tiddler="CapEachWord" modified="200512121516" modifier="TableSmith" tags="">!!!Format\n{~CapEachWord~Text}\n\n!!!Description\nThis function will return &quot;Text&quot; with each word capitalized. A &quot;word&quot; is determined by text with a space in front of it.\n\n!!!Example\n{~CapEachWord~druids and dragons} returns &quot;Druids And Dragons&quot;.</div>
<div tiddler="Sqrt" modified="200512121517" modifier="TableSmith" tags="">!!!Format\n{Sqrt~Value}\n\n!!!Description\nReturns the square root of &quot;Value&quot;.\n\n!!!Example\n{Sqrt~9} returns &quot;3&quot;.</div>
<div tiddler="Picture" modified="200512121518" modifier="TableSmith" tags="">!!!Format\n{Picture~Filename}\n\n!!!Description\nThe graphic file &quot;Filename&quot; will be displayed in the results window. This file must be found in the &quot;Graphics&quot; folder, found in the TableSmith folder, and the extension must be part of &quot;Filename&quot;. Any format that Microsoft Internet Explorer supports can be \nused, such as JPEG (.jpg), GIF (.gif), and PNG (.png).\n\n!!!Example\n{Picture~skeleton.jpg}</div>
<div tiddler="Msg" modified="200512121519" modifier="TableSmith" tags="">!!!Format\n{Msg~Text}\n\n!!!Description\nDisplays &quot;Text&quot; in a message box; table execution is halted until the user clicks &quot;OK&quot;.\n\n!!!Example\n{Msg~Generating village} displays a message box which says &quot;Generating village&quot;.</div>
<div tiddler="Bold" modified="200512121520" modifier="TableSmith" tags="">!!!Format\n{Bold~Text}\n\n!!!Description\n&quot;Text&quot; will be displayed in boldface in the results window.\n\n!!!Example\nThe {Bold~dragon} is red will be displayed as: The ''dragon'' is red.</div>
<div tiddler="AorAn" modified="200512121521" modifier="TableSmith" tags="">!!!Format\n{~AorAn~Text}\n\n!!!Description\nIf &quot;Text&quot; starts with a vowel, this function appends &quot;an &quot; to the front of it; otherwise, it appends &quot;a &quot; to the front.\n\n!!!Example\n{~AorAn~ostrich} returns &quot;an ostrich&quot;.</div>
<div tiddler="Floor" modified="200512121524" modifier="TableSmith" tags="">!!!Format\n{Floor~Value}\n\n!!!Description\nReturns the largest integer smaller than or equal to &quot;Value&quot;.\n\n!!!Example\n{Floor~2} returns 2, {Floor~1.3} returns 1, {Floor~-2.3} returns -3.</div>
<div tiddler="Plural" modified="200512121543" modifier="TableSmith" tags="">!!!Format\n{Plural~Text}\n\n!!!Description\nThis function will return &quot;Text in its plural form. The following rules are used:\n* Words ending in &quot;ch&quot;, &quot;o&quot;, &quot;s&quot;, &quot;sh&quot;, &quot;x&quot;, or &quot;z&quot;, are returned with &quot;es&quot; added to the end.\n* Words ending in &quot;f&quot; or &quot;fe&quot; are returned with &quot;f&quot; or &quot;fe&quot; replaced by &quot;ves&quot;.\n* Words ending in a consonant and &quot;y&quot; are returned with &quot;y&quot; replaced by &quot;ies&quot;.\n* All other words are returned with &quot;s&quot; added to the end.\n\n!!!Example\n{Plural~wolf} returns &quot;wolves&quot;.</div>
<div tiddler="OrderAsc" modified="200512121549" modifier="TableSmith" tags="">!!!Format\n{~OrderAsc~&quot;X&quot;,Text}\n\n!!!Description\n~OrderAsc takes &quot;Text&quot;, divides it up using &quot;X&quot; (must be a single character in quotes) as a delimiter, and returns text with its elements sorted in ascending order (divided by &quot;X&quot;).\n\n!!!Example\n{~OrderAsc~&quot;,&quot;,skeleton,orc,troll} returns &quot;orc,skeleton,troll&quot;</div>
<div tiddler="OrderDesc" modified="200512121549" modifier="TableSmith" tags="">!!!Format\n{~OrderDesc~&quot;X&quot;,Text}\n\n!!!Description\n~OrderDesc takes &quot;Text&quot;, divides it up using &quot;X&quot; (must be a single character in quotes) as a delimiter, and returns text with its elements sorted in descending order (divided by &quot;X&quot;).\n\n!!!Example\n{~OrderDesc~&quot;,&quot;,skeleton,orc,troll} returns &quot;troll,skeleton,orc&quot;</div>
<div tiddler="Ordinal" modified="200512121554" modifier="TableSmith" tags="">!!!Format\n{Ordinal~Value}\n\n!!!Description\nOrdinal returns &quot;Value&quot; with the appropriate suffix attached (i.e.; &quot;1st&quot; for 1, &quot;22nd&quot; for 22, &quot;458th&quot; for 458, etc.).\n\n!!!Example\n{Ordinal~37} returns &quot;37th&quot;.</div>
<div tiddler="MinVal" modified="200512121558" modifier="TableSmith" tags="">!!!Format\n{~MinVal~~GroupName,X}\n\n!!!Description\n~MinVal looks at the entry on line &quot;X&quot; of group &quot;~GroupName&quot;, and returns the minimum number it has within the group.\n\n!!!Example\nGiven the group &quot;Weapons&quot;, with the first line being &quot;4,dagger&quot; and the second line being &quot;3,scimitar&quot;, {~MinVal~Weapons,1} would return &quot;1&quot; (1-4 would yield &quot;dagger&quot;, 5-7 would yield &quot;scimitar&quot;). {~MinVal~Weapons,2} would return &quot;5&quot;.</div>
<div tiddler="MaxVal" modified="200512121559" modifier="TableSmith" tags="">!!!Format\n{~MaxVal~~GroupName,X}\n\n!!!Description\n~MaxVal looks at the entry on line &quot;X&quot; of group &quot;~GroupName&quot;, and returns the maximum number it has within the group.\n\n!!!Example\nGiven the group &quot;Weapons&quot;, with the first line being &quot;4,dagger&quot; and the second line being &quot;3,scimitar&quot;, {~MaxVal~Weapons,1} would return &quot;4&quot; (1-4 would yield &quot;dagger&quot;, 5-7 would yield &quot;scimitar&quot;). {~MaxVal~Weapons,2} would return &quot;7&quot;.</div>
<div tiddler="Right" modified="200512121611" modifier="TableSmith" tags="">!!!Format\n{Right~X,Text}\n\n!!!Description\nReturns the X rightmost characters from &quot;Text&quot;.\n!!!Example\n{Right~4,~TableSmith} will return &quot;mith&quot;.</div>
<div tiddler="Mid" modified="200512121612" modifier="TableSmith" tags="">!!!Format\n{Mid~X,Y,Text}\n\n!!!Description\nStarting with the &quot;Y&quot;th character, returns &quot;X&quot; characters from &quot;Text&quot;.\n\n!!!Example\n{Mid~5,2,~TableSmith} will return &quot;ableS&quot;.</div>
<div tiddler="Max" modified="200512121616" modifier="TableSmith" tags="">!!!Format\n{Max~Value1,Value2,...}\n\n!!!Description\nReturns the largest value from the list.\n\n!!!Example\n{Max~5,7,14} returns &quot;14&quot;</div>
<div tiddler="Min" modified="200512121616" modifier="TableSmith" tags="">!!!Format\n{Min~Value1,Value2,...}\n\n!!!Description\nReturns the smallest value from the list.\n\n!!!Example\n{Min~5,7,14} returns &quot;5&quot;</div>
<div tiddler="DSCount" modified="200512121619" modifier="TableSmith" tags="">!!!Format\n{~DSCount~~VarName}\n\n!!!Description\nReturns the number of items in the dataset &quot;~VarName&quot;.\n\n!!!Example\n{~DSCount~weapons}\n\nIf &quot;weapons&quot; consists of three items, this will return &quot;3&quot;.</div>
<div tiddler="DSCreate" modified="200512121619" modifier="TableSmith" tags="">!!!Format\n{~DSCreate~~VarName,Field1,Default1,Field2,Default2,...Fieldx,Defaultx}\n\n!!!Description\nCreates a dataset and assigns it to the variable //~VarName//. //Fieldx// defines the name of a field in the dataset, and //Defaultx// is what the default value for each field is. You can have as many fields as you want, but you must list a field name //and// a default for each one. Datasets created with this function do not have any items in them.\n\n!!!Example\n{~DSCreate~weapons,name,xxxxx,weight,0,cost,0}\n\nCreates a dataset with three fields - name, weight, and cost. The default values for newly added items will be &quot;xxxxx&quot;, 0, and 0, respectively. This dataset has been put into a variable named &quot;weapons&quot;.</div>
<div tiddler="Mod" modified="200512121621" modifier="TableSmith" tags="">!!!Format\n{Mod~X,Y}\n\n!!!Description\nDivides &quot;X&quot; by &quot;Y&quot; and returns the remainder.\n\n!!!Example\n{Mod~5,2} would return &quot;1&quot; (5 divided by 2 is 2, remainder 1).</div>
<div tiddler="Italic" modified="200512121622" modifier="TableSmith" tags="">!!!Format\n{Italic~Text}\n\n!!!Description\n&quot;Text&quot; will be displayed in italics in the results window.\n\n!!!Example\nThe {Italic~dragon} is red will be displayed as: The //dragon// is red.</div>
<div tiddler="Find" modified="200512121626" modifier="TableSmith" tags="">!!!Format\n{Find~X,Text1,Text2}\n\n!!!Description\nStarting at character &quot;X&quot;, return the character location where &quot;Text1&quot; is found within &quot;Text2&quot; (if &quot;Text1&quot; cannot be found in &quot;Text2&quot;, 0 will be returned).\n\n!!!Example\n{Find~1,able,~TableSmith} will return &quot;2&quot; (&quot;able&quot; is found in &quot;~TableSmith&quot; starting at the 2nd character).</div>
<div tiddler="Count" modified="200512121629" modifier="TableSmith" tags="">!!!Format\n{Count~~GroupName}\n\n!!!Description\nCount will return the number of entries in &quot;~GroupName&quot;. A group with three entries would return &quot;3&quot;, a group with ten entries would return &quot;10&quot;, etc.</div>
<div tiddler="Reset" modified="200512121630" modifier="TableSmith" tags="">!!!Format\n{Reset~~GroupName}\n\n!!!Description\nResets the specified group (if the group is a &quot;non-repeating&quot; group, it clears the &quot;used&quot; flags for that group's entries).\n\n!!!Example\n{Reset~Gems} resets the group &quot;Gems&quot;.</div>
<div tiddler="Debug" modified="200512121631" modifier="TableSmith" tags="">!!!Format\n{Debug~Caption}\n\n!!!Description\n{Debug~Caption}\nDisplays various data for debugging purposes (intended for more advanced users). Displays a dialog box with &quot;caption&quot; as its caption, along with a list showing all the variables and their values for the current table, system resource/memory information, and the number of times the main TableSmith routine has been looped through.</div>
<div tiddler="Extern" modified="200512121632" modifier="TableSmith" tags="">!!!Format\n{Extern~Library.Object,~StringToPass}\n\n!!!Description\nCalls the &quot;main&quot; function of &quot;Library.Object&quot;, feeding it &quot;~StringToPass&quot;. Intended to be used with add-ons for TableSmith; the use of Extern is something that is covered by individual add-on authors.\n\n''NOT CURRENTLY OPERATIONAL''</div>
<div tiddler="Lockout" modified="200512121633" modifier="TableSmith" tags="">!!!Format\n{Lockout~~GroupName,Values}\n\n!!!Description\nIn a non-repeating table, Lockout flags the entries with the probability values listed as already selected. &quot;Values&quot; can be a single number, a range of numbers, or a combination.\n\n!!!Example\n{Lockout~Animals,3,7-9} will flag whatever entries encompass 3, 7, 8, and 9 as already being used.</div>
<div tiddler="Round" modified="200512121635" modifier="TableSmith" tags="">!!!Format\n{Round~X,Value}\n\n!!!Description\nReturns &quot;Value&quot; rounded to &quot;X&quot; decimal places.\n\n!!!Example\n{Round~1,5.32} returns &quot;5.3&quot;</div>
<div tiddler="Replace" modified="200512121638" modifier="TableSmith" tags="">!!!Format\n{Replace~~SearchFor,~ReplaceWith,Text}\n\n!!!Description\nReplaces each instance of &quot;~SearchFor&quot; in &quot;Text&quot; with &quot;~ReplaceWith&quot;.\n\n!!!Example\n{Replace~e,@,skeleton} returns &quot;sk@l@ton&quot;.</div>
<div tiddler="Split" modified="200512121640" modifier="TableSmith" tags="">!!!Format\n{Split~~VarNameToSplit,&quot;X&quot;,~VarName1,~VarName2,~VarName3,...}\n\n!!!Description\nThe Split function is somewhat complex. Following the &quot;~&quot;, is the name of a variable (without &quot;%&quot;'s), then a delimiter (in quotes), and then a list of variables. What Split does is to take the first variable (&quot;~VarNameToSplit&quot; shown above), divide it up, and copy the results into the variable list (&quot;~VarName1&quot;, &quot;~VarName2&quot;, etc.). The delimiter character is used to divide the first variable.\n\n!!!Example\nGiven the variables &quot;~AbilityScores&quot;, &quot;Str&quot;, &quot;Int&quot;, and &quot;Agi&quot; with &quot;~AbilityScores&quot; equal to &quot;78,56,60&quot;, {Split~~AbilityScores,&quot;,&quot;,Str,Int,Agi} would assign &quot;78&quot; to the variable Str, &quot;56&quot; to Int, and &quot;60&quot; to Agi.</div>
<div tiddler="Param" modified="200512121642" modifier="TableSmith" tags="">!!!Format\n{Param~~VarName,X}\n\n!!!Description\nIf &quot;~VarName&quot; is used as a list or multi-list parameter, the list item at index &quot;X&quot; will be returned.\n\n!!!Example\nIf &quot;Class&quot; is a parameter variable with entries &quot;Warrior,Priest,Wizard,Rogue&quot;, then {Param~Class,3} will return &quot;Wizard&quot;</div>
<div tiddler="Note" modified="200512121646" modifier="TableSmith" tags="">!!!Format\n{Note~Text}\n\n!!!Description\nDisplays &quot;Text&quot; in the results window in green; the text can be clicked on, and the user can change what the text says. This editted information replaces what was originally in the results window.</div>
<div tiddler="Status" modified="200512121647" modifier="TableSmith" tags="">!!!Format\n{Status~Text}\n\n!!!Description\nDisplays &quot;Text&quot; in the right panel of the TableSmith status bar. This text remains until changed by another call to Status; &quot;{Status~}&quot; will clear the panel.\n\n!!!Example\n{Status~Generating village} displays &quot;Generating village&quot; in the status bar's right panel.</div>
<div tiddler="Unlock" modified="200512121648" modifier="TableSmith" tags="">!!!Format\n{Unlock~~GroupName,Values}\n\n!!!Description\nIn a non-repeating table, Unlock clears the &quot;already selected&quot; flags of the entries with the probability values listed. &quot;Values&quot; can be a single number, a range of numbers, or a combination.\n\n!!!Example\n{Unlock~Gems,3,7-9} will clear the flags for whatever entries encompass 3, 7, 8, and 9 so they can be used again.</div>
<div tiddler="Used" modified="200512121650" modifier="TableSmith" tags="">!!!Format\n{Used~~GroupName,Value}\n\n!!!Description\nThe Used function is used to determine if an entry in a non-duplicating group has already been called. Following the &quot;~&quot; is the name of a group and then a number. If the entry that that number corresponds to has already been selected in the specified group, the function returns a 1. If not, 0 is returned. If that entry cannot be found (ex: the group goes from 1-10 and the number is 12), then -1 is returned. Passing in a &quot;0&quot; as the entry number checks all items in the group, returning a 1 if the group is &quot;used up&quot;. \n\n!!!Example\n{Used~Weapons,5} returns &quot;1&quot; if entry 5 has already been used, 0 if not, and -1 if entry 5 does not exist in &quot;Weapons&quot;.</div>
<div tiddler="Loop" modified="200512121655" modifier="TableSmith" tags="">!!!Format\n{Loop~X,Value}\n\n!!!Description\nDisplays the results of &quot;Value&quot; &quot;X&quot; number of times.\n\n!!!Example\n{Loop~3,Hello!} will return &quot;Hello!Hello!Hello!&quot;.</div>
<div tiddler="Stop" modified="200512121655" modifier="TableSmith" tags="">!!!Format\n{Stop~Text}\n\n!!!Description\nDisplays &quot;Text&quot; in a message box; table execution is halted once the user clicks &quot;OK&quot;.\n\n!!!Example\n{Stop~Generating village} displays a message box which says &quot;Generating village&quot;, then stops when user clicks &quot;OK&quot;.</div>
<div tiddler="Calc" modified="200512121704" modifier="TableSmith" tags="">!!!Format\n{Calc~Expr}\n\n!!!Description\nThis function will return the results of the mathematical expression given to it. The function will recognize addition, subtraction, division, division with truncation, and multiplication (+,-,/,\s,*). Parentheses can be used as well. Note that if you use variables in the expression, make sure a space divides the &quot;%&quot; of any variable from the division sign (&quot;/&quot;).\n\n!!!Example\n{Calc~(3*(5+2))} returns &quot;21&quot;</div>
<div tiddler="And" modified="200512121704" modifier="TableSmith" tags="">!!!Format\n{And~Expr1,Expr2}\n\n!!!Description\nReturns 1 if both &quot;Expr1&quot; and &quot;Expr2&quot; are true; otherwise returns 0. If there is an error in either, returns -1.\n\nSee the [[If]] function for information on the format of &quot;Expr&quot;.\n\n!!!Example\n{And~%var1%&gt;3,%var2%=2} returns &quot;1&quot; if var1 is greater than 3 and var2 equals 2.</div>
<div tiddler="Xor" modified="200512121705" modifier="TableSmith" tags="">!!!Format\n{Xor~Expr1,Expr2}\n\n!!!Description\nIf either Expr1 or Expr2 are true, returns 1. If both are false or both are true, returns 0. If there is an error in either, returns -1.\n\nSee the [[If]] function for information on the format of &quot;Expr&quot;.\n\n!!!Example\n{Xor~%var1%&gt;3,%var2%=2} returns &quot;1&quot; if var1 is greater than 3 or if var2 equals 2, but not if that is the case for both.</div>
<div tiddler="Or" modified="200512121705" modifier="TableSmith" tags="">!!!Format\n{Or~Expr1,Expr2}\n\n!!!Description\nIf either Expr1 or Expr2 are true, or both are, returns 1. If both are false, returns 0. If there is an error in either, returns -1.\n\nSee the [[If]] function for information on the format of &quot;Expr&quot;.\n\n!!!Example\n{Or~%var1%&gt;3,%var2%=2} returns 1 if var1 is greater than 3 and/or if var2 equals 2.</div>
<div tiddler="IIf" modified="200512121708" modifier="TableSmith" tags="">!!!Format\n{~IIf~Expr ? Result1:Result2}\n\n!!!Description\nWorks identically to [[If]], using &quot;:&quot; rather than &quot;/&quot;.\n\nUse &quot;~IIf&quot; if you need a result that uses a slash (perhaps for an HTML or XML closing tag), but not a colon (you can still print a colon with the HTML code &quot;&amp;#058;&quot;).</div>
<div tiddler="Generate" modified="200512121711" modifier="TableSmith" tags="">!!!Format\n{Generate~0,Text,~GroupCall}\n\n!!!Description\nThis function allows you to embed a link into your results that will additional generation in the future. The first parameter must be &quot;0&quot; (&quot;Generate&quot; may allow different values in the future, but for now it just takes &quot;0&quot;). The &quot;~GroupCall&quot; is a call to a table or group, similar in syntax to a standard group call, but without the square brackets (&quot;[&quot;, &quot;]&quot;); it may include parameters and/or modifiers as well. &quot;Text&quot; is the linkable text to display in the results window. When this text is clicked, the group call that's been specified will be made and the results substituted for &quot;Text&quot;.</div>
<div tiddler="DSWrite" modified="200512121712" modifier="TableSmith" tags="">!!!Format\n{~DSWrite~~VarName,Filename}\n\n!!!Description\nWrites the dataset in &quot;~VarName&quot; to a data file. The data file will be named &quot;Filename.tsd&quot; and will reside in TableSmith's &quot;Data&quot; folder.</div>
<div tiddler="DSRemove" modified="200512121713" modifier="TableSmith" tags="">!!!Format\n{~DSRemove~VarName,Index}\n\n!!!Description\nRemoves the item at &quot;Index&quot; in dataset &quot;~VarName&quot;.</div>
<div tiddler="DSRead" modified="200512121715" modifier="TableSmith" tags="">!!!Format\n{~DSRead~~VarName,Filename}\n\n!!!Description\nReads the file &quot;Filename.tsd&quot; into &quot;~VarName&quot;. &quot;Filename&quot; must reside in TableSmith's &quot;Data&quot; folder.</div>
<div tiddler="DSGet" modified="200512121721" modifier="TableSmith" tags="">!!!Format\n{~DSGet~~VarName,Index,Field}\n\n!!!Description\nReturns the value of &quot;Field&quot; in the item at &quot;Index&quot; in the dataset &quot;~VarName&quot;.</div>
<div tiddler="DSSet" modified="200512121721" modifier="TableSmith" tags="">!!!Format\n{~DSSet~~VarName,Index,Field1,Value1,Field2,Value2,...}\n\n!!!Description\nFor the item at &quot;Index&quot; in dataset &quot;~VarName&quot;, sets the values of &quot;Fieldx&quot; to &quot;Valuex&quot;.\n\n!!!Example\n{~DSSet~~weapons,2,name,longsword,weight,15,cost,30}\n\nThis takes the second item in the dataset &quot;weapons&quot; and sets &quot;name&quot; to &quot;longsword&quot;, &quot;weight&quot; to 15, and &quot;cost&quot; to 30.\n</div>
<div tiddler="DSSort" modified="200512121722" modifier="TableSmith" tags="">!!!Format\n{~DSSort~~VarName,Field1,Direction1,Field2,Direction2,...}\n\n!!!Description\nSorts the items in dataset &quot;~VarName&quot;. You can sort on as many fields as you want, but each field also needs a direction listed with it (0 is ascending - in alphabetic/numeric order; 1 is descending - reverse alphabetic/numeric order). If you have multiple fields defined, the dataset will sort based on the first field, then sort on the second field for items where the first field is the same, then sort on the next field for items where the previous field was the same, etc.</div>
<div tiddler="Power" modified="200512131043" modifier="TableSmith" tags="">!!!Format\n{Power~X^Y}\n\n!!!Description\nReturns the result of &quot;X&quot; raised to the power of &quot;Y&quot;.\n\n!!!Example\n{Power~2^3} returns 8</div>
<div tiddler="Help Topics" modified="200512131054" modifier="TableSmith" tags="">Welcome to TableSmith! This powerful tool is intended to aid RPG Gamemasters by providing an easy-to-use system for creating and using tables and charts for their campaigns.\n\nThis help file is brief, but TableSmith features an intuitive interface, so no more is needed. With a small amount of effort, you'll be up and running in no time!\n\nClick on the topic below for which you would like help.\n\n!!!Using ~TableSmith\n[[TableSmith Interface]]\nInstructions on using the program.\n\n[[TableSmith Categories]]\nHow to categorize your tables.\n\n!!!Creating and Modifying Tables\n[[Basic File Format]]\nExplains the basic TableSmith scripting format and includes a short tutorial.\n\n[[Advanced TableSmith Scripting]]\nCovers the advanced features of TableSmith's scripting format.\n\n!!!Other Information\n[[Support]]\nTableSmith technical support policy.\n\n[[Revision History]]\nThe history of TableSmith's development.\n\n[[System Requirements]]\nWhat do you need to run TableSmith?\n\n[[Registration]]\nTableSmith is shareware - please register!\n\n[[Legal Information]]\nThe usual legal software information.</div>
<div tiddler="PluralIf" modified="200512131056" modifier="TableSmith" tags="">!!!Format\n{PluralIf~X,Text}\n\n!!!Description\nThis function will return &quot;Text in its plural form (see [[Plural]] for criteria) if &quot;X&quot; does not equal 1.\n\n!!!Example\n{PluralIf~%num%,wolf} returns &quot;wolves&quot; if &quot;num&quot; is not one, &quot;wolf&quot; if &quot;num&quot; equals 1.</div>
<div tiddler="CommaReplace" modified="200512131103" modifier="TableSmith" tags="">!!!Format\n{~CommaReplace~X,Text1,Text2}\n\n!!!Description\nIf &quot;X&quot; = 0, all instances of a comma (&quot;,&quot;) in &quot;Text2&quot; will be replaced with &quot;Text1&quot;.\n\nIf &quot;X&quot; = 1, all instances of &quot;Text1&quot; in &quot;Text2&quot; will be replaced with a comma.\n\n!!!Example\n{~CommaReplace~0,@,5,7,8} will return &quot;5@7@8&quot;.\n\n{~CommaReplace~1,##,dec##may##jul} will return &quot;dec,may,jul&quot;.</div>
<div tiddler="DSRoll" modified="200512131119" modifier="TableSmith" tags="">!!!Format\n{~DSRoll~~VarName,Field@Mod}\n\n!!!Description\nThis function select a random item in the dataset &quot;~VarName&quot; and returns its index. &quot;Field&quot; is a field in the dataset that should contain a number. When &quot;rolling&quot;, ~DSRoll treats the dataset as a group with weighted probability. Records with a &quot;0&quot; are ignored and not considered part of the dataset.\n\n&quot;@Mod&quot; is optional; &quot;@&quot; is &quot;+&quot;, &quot;-&quot;, or &quot;=&quot;, Mod is a number (works like a group call or the [[Dice]] function).\n\n!!!Example\nA dataset named &quot;encounters&quot; contains:\n\n|!Index|!probRuin|!probHills|!name|\n|1|2|5|orc|\n|2|4|2|skeleton|\n|3|3|0|golem|\n|4|1|3|dire wolf|\n\n{~DSRoll~encounters,prbRuin} treats the dataset as the first record being &quot;1-2&quot;, the second as &quot;3-6&quot;, third as &quot;7-9&quot;, and the last as &quot;10&quot;. It generates a number from 1-10 and returns the index of the appropriate record. If it rolled &quot;5&quot;, then ~DSRoll would return a &quot;2&quot;. If it rolled a 9, ~DSRoll would return &quot;3&quot;.\n\n{~DSRoll~encounters,prbHills} would do the following: First record is &quot;1-5&quot;, second is &quot;6-7&quot;, third is ignored, fourth is &quot;8-10&quot;. Rolling &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot; returns &quot;1&quot;. &quot;6&quot; and &quot;7&quot; return &quot;2&quot;. &quot;8&quot;, &quot;9&quot;, &quot;10&quot; return &quot;3&quot;.</div>
<div tiddler="Log" modified="200512131724" modifier="TableSmith" tags="">!!!Format\n{Log~Filename,Text}\n\n!!!Description\nAdds &quot;Text&quot; to the end of a text file called &quot;Filename&quot;.\n\n!!!Example\n{Log~C:\slog.txt,Generated line 14} will write &quot;Generated line 14&quot; at the end of the file &quot;C:\slog.txt&quot;.</div>
<div tiddler="LogNew" modified="200512131724" modifier="TableSmith" tags="">!!!Format\n{~LogNew~Filename,Text}\n\n!!!Description\nWrites &quot;Text&quot; into a newly created text file called &quot;Filename&quot;.\n\n!!!Example\n{~LogNew~C:\slog.txt,Generated line 14} will create a file named &quot;C:\slog.txt&quot; and write &quot;Generated line 14&quot; into it.</div>
<div tiddler="Char" modified="200512131733" modifier="TableSmith" tags="">!!!Format\n{Char~X,Text}\n\n!!!Description\nReturns the &quot;X&quot;th character from &quot;Text&quot;.\n\n!!!Example\n{Char~2,knight} will return &quot;n&quot;.</div>
<div tiddler="Results Window" modified="200512201455" modifier="TableSmith" tags="">The majority of the TableSmith interface is taken up by the Results Window. This is where the results from rolling on a Table are displayed. Most results will be displayed in HTML format which causes the window to act like a Web browser. This is also the case for XML and Text tables. For List tables the results window acts like a checklist.</div>
<div tiddler="Parameters Window" modified="200512201459" modifier="TableSmith" tags="">Some tables use &quot;parameters&quot;, values that can be passed into them. To set the parameters for a table, select &quot;Set Parameters&quot; from the &quot;Table&quot; menu, click the &quot;Set Parameters&quot; button, or press &quot;F11&quot;.\n\nA window will appear showing the list of parameters at the top and their current values. Selecting a parameter will display it at the bottom of the window along with a list of choices for you to select from or a text box for you to enter something in. Parameters can be selected by clicking on them in the upper part of the window or by clicking &quot;Next&quot; or &quot;Prev(ious)&quot; at the bottom.\n\nOnce you are satisfied with your parameter selections, click &quot;Finish&quot;. To abort the process, click &quot;Cancel&quot;.</div>
<div tiddler="Preferences" modified="200512201508" modifier="TableSmith" tags="">You may set preferences governing how TableSmith's behaviour. Selecting &quot;Preferences&quot; from the &quot;File&quot; menu will display a dialog box listing these preferences. They are organized into two categories, and are detailed below:\n\n!!!General\n//Re-select - re-run current table on a &quot;reload&quot;//\nIf you leave this unchecked, TableSmith will reset itself to the state it is in at start-up when you click the &quot;Reload&quot; button or menu option. If you check this, it will reset itself as described, but then immediately select (and therefore run) the table you had selected before clicking Reload.\n\n//Remove links on HTML export//\nText that may be re-rolled, or that was generated with the &quot;Notes&quot; function, will appear as blue or green links in a Web browser when you open an exported HTML file. However, browsers outside of TableSmith won't understand what these links mean when you click on them. If you don't wish to have the links in your exported HTML files, check this option.\n\n//Separate results with a blank line//\nCheck this if you want blank lines between your results; uncheck it if you don't.\n\n//Table Editor//\nYou may select Notepad (part of Windows) to edit your tables or another editor. If you select &quot;Other&quot; you will need to specify which program to use for your editor.\n\n!!!Folders\nClicking the &quot;...&quot; button allows you to select the folder where different TableSmith elements are stored. By default, they are all located in the TableSmith folder, but you may change them if you wish (click on the &quot;...&quot; button to do so).\n\nThe folders are:\n* Archives: This is where your [[Archives]] are stored.\n* Data: This is where files are stored for [[Datasets]].\n* Images: This is the folder used by the [[Picture]] function.\n* Tables: This is where your table files/categories are located.</div>
<div tiddler="Designate Output Type" modified="200512201516" modifier="TableSmith" tags="">!!!Format\n/~OutputType xxx\n\n!!!Description\nNormally, TableSmith generates results in HTML format. If you wish, you can force the table to generate (and TableSmith to display) results as Text, XML, or a checklist. To do so, use &quot;Text&quot;, &quot;XML&quot;, or &quot;List&quot; for &quot;xxx&quot; above.\n\n!!!Example\n/~OutputType XML\n\nThis will generate a table in XML format rather than HTML.</div>
<div tiddler="MainMenu" modified="200512201518" modifier="TableSmith" tags="">[[Help Topics]]\n[[TableSmith Interface]][[TableSmith Categories]][[Basic File Format]][[Advanced TableSmith Scripting]][[Support]][[Revision History]]\n[[System Requirements]][[Registration]][[Legal Information]]\n</div>
<div tiddler="DSFind" modified="200512201521" modifier="TableSmith" tags="">!!!Format\n{~DSFind~~VarName,Index,Expr1,Expr2,...}\n\n!!!Description\nStarting at the item with index &quot;Index&quot;, searches through each item until it finds one where the given &quot;Exprx&quot; are true and returns the index of that item (if not match is found, &quot;-1&quot; is returned). &quot;Exprx&quot; follows the format &quot;fieldname XXX value&quot;. &quot;XXX&quot; is a comparison operator, similar to what you use for &quot;[[If]]/IIf&quot;. The following operators are recognized: =, !=, &lt;=, &gt;=, &gt;, &lt;, ~, and !~. All but the last two work both with numbers and text. The last two work only with text. &quot;~&quot; means &quot;like&quot; and &quot;!~&quot; means &quot;not like&quot;. If you want to use wildcards with your text search, use &quot;~&quot; and &quot;!~&quot;.</div>
<div tiddler="Groups" modified="200512201521" modifier="TableSmith" tags="">The parts of the table above starting with &quot;Start&quot;, &quot;Creature&quot;, and &quot;Color&quot; are //groups//. A group consists of a name, followed by //entries//. A group may have any name you wish, though you should stick to only alphanumerics (i.e.; letters and numbers) and underscores (&quot;_&quot;). Group and table names cannot contain the characters &quot;+&quot;, &quot;-&quot;, or &quot;=&quot; as these have special meaning to TableSmith. In addition, other characters that may work now might not work in the future, so stick to &quot;~A-Z&quot;, &quot;a-z&quot;, &quot;0-9&quot;, and &quot;_&quot;.\n\nGroups are preceded in a table by a colon (&quot;:&quot;). Groups can be considered &quot;subtables&quot; within the larger table files. Note: There is one &quot;special&quot; group, known as &quot;Start&quot;. Whenever a table is selected from TableSmith, the first group that is rolled on is &quot;Start&quot; (it has to start //somewhere//).\n\n!!!Group Entries\nThe entries under each group follow a specific format, which is:\n\nnumber,text\n\nNote that the comma is //very// important. When an entry is read into TableSmith, everything up to the first comma it reads is used for probability, and everything after is a line of text. Note that if you put a space after the comma, that space is part of your line of text. Also note that when it comes to commas, TableSmith only cares about the first one it finds. You may put commas in anywhere in your text line that you care to.\n\nThe number before the comma in an entry line is a probability. This is the chance that that particular line will be used if the group is called elsewhere in a table. For instance, in the &quot;Color&quot; group in the example, the entry &quot;Red&quot; has a number of 1. Since the range of numbers for that group is 1-4, if the Color group is called for something, a random number from 1 to 4 will be generated, and if it comes up a &quot;1&quot;, &quot;Red&quot; will be the text used from the Color group.\n\nThe probability number may be either a single value, or a range, in the format of &quot;~X-Y&quot;, where &quot;X&quot; is the lower limit of the range and &quot;Y&quot; the upper. The range for a group is determined by the lower limit (or value if a single number) of the first entry beneath it and the upper limit of its last entry. In the example above, when rolling on the &quot;Creature&quot; group, the range is 1-9, and for the &quot;Color&quot; group, it is 1-4. ''Note:'' This number cannot be negative, and if a &quot;0&quot; is used, that entry will not be used (though &quot;0&quot; won't generate an error).\n\n!!!Alternate Group Format\nGroups may also use a different format. It is similar to the above, but looks like this:\n\n;Weapons\n3,Sword\n2,Axe\n5,Dagger\n2,Pole arm\n\nThis type of group works in a similar manner, but rather than the numbers describing ranges, they describe relative probabilities. In the example above, for instance, the 3 represents &quot;1-3&quot;, the 2 is &quot;4-5&quot;, the dagger has a range of &quot;6-10&quot;, and the pole arm's 2 is the equivalent of &quot;11-12&quot;. Groups using this format start with a semi-colon (&quot;;&quot;), rather than a colon (&quot;:&quot;).\n\n!!!Groups that Don't Repeat\nIf you include an exclamation point (&quot;!&quot;) after a group designator (&quot;:&quot; or &quot;;&quot;), this will signal TableSmith that the group should not allow duplicate results. In other words, if an item is selected in the group, and the group is called later, previously selected items will not be selected again. For example, take a group that looks like this:\n\n;!Weapons\n3,Sword\n2,Axe\n5,Dagger\n2,Pole arm\n\nLet's say a roll on the group selects &quot;Dagger&quot; returns that to the caller. Later in the table, this &quot;Weapons&quot; group is called again. On this roll, the result will be anything //but// &quot;Dagger&quot;, since that has already been used. Say the result of the second roll is &quot;Axe&quot;. Now, if this table is called a third time, the only results that can be returned will either be &quot;Sword&quot; or &quot;Pole arm&quot;.\n\n''Note:'' Take care when using this feature. TableSmith will give you an error (appearing in your table output) if a group is called that is already &quot;maxed-out&quot; (i.e.; it is a non-repeating group that has had all its entries used).</div>
<div tiddler="DSCalc" modified="200512201521" modifier="TableSmith" tags="">!!!Format\n{~DSCalc~~VarName,Operation,Field}\n\n!!!Description\nPerforms a mathematical calculation on the data in a dataset. &quot;~VarName&quot; is the name of the dataset, &quot;Field&quot; is the field the operation is being performed on. &quot;Operation&quot; can be one of the following:\n\n* &quot;Sum&quot;: This will take the value in &quot;Field&quot; for each item and provide their sum.\n* &quot;Avg&quot;: This will take the value in &quot;Field&quot; for each item and provide their average.</div>
<div tiddler="DSRandomize" modified="200512201522" modifier="TableSmith" tags="">!!!Format\n{~DSRandomize~~VarName}\n\n!!!Description\nRe-arranges the items in dataset &quot;~VarName&quot; in a random order.</div>
<div tiddler="Functions" modified="200602081024" modifier="TableSmith" tags="">Functions are a feature of TableSmith that allow you to perform some sort of action that you couldn't otherwise do with the standard table format or which could be done but only with great difficulty. The &quot;[[Dice]]&quot; function has already been detailed in the [[Basic File Format]] section; TableSmith supports many more.\n\nFunctions follow the format below:\n\n@@color(darkgreen):{~FunctionName~nnnn,nnnn,nnnn,...}@@\n\n&quot;~FunctionName&quot; is the name of the function. It is followed by a &quot;~&quot;, and one or more values (the number and the type depend on the particular function). Some functions return text (which replaces the &quot;{&quot;, &quot;}&quot;, and everything in-between), some manipulate variables. Functions can be viewed below either grouped by category or in alphabetical order (note that some functions use the names of variables; in those cases, you do ''not'' surround the variable name with &quot;%&quot;, as the function wants the variable's name, not what it contains).\n\n[[Functions - Grouped by Category]]\n[[Functions - Listed Alphabetically]]</div>
<div tiddler="Dice Function" modified="200602090023" modifier="YourName" tags="">Part of the table contains &quot;{Dice~1d6*1000}&quot;. This is a //function call//, specifically to the [[Dice]] function. [[Functions]] are covered in [[Advanced TableSmith Scripting]]. You don't need to know the full details of functions to use [[Dice]] at this point. All you need to know for now is that if you want to display the results of a die roll, write your formula in the standard RPG format (3d6+1, 2d4, 1d100, 2d10*2, etc.) and put &quot;{Dice~&quot; before it and &quot;}&quot; after.</div>
<div tiddler="Space" modified="200602132223" modifier="YourName" tags="">!!!Format\n{Space~X} or {Spc~X}\n\n!!!Description\nInserts &quot;X&quot; number of spaces. These will be standard spaces in a Text or XML file (&quot; &quot;) and non-breaking spaces (&quot;&amp;nbsp;&quot;) in an HTML file.</div>
<div tiddler="TableSmith Interface" modified="200603301743" modifier="Bruce" tags="">The TableSmith main window consists of four main areas:\n\n[[Menu and Toolbar]]\n[[Category and Table Lists]]\n[[Results Window]]\n[[Favorites]]\n\nOther areas of the interface include:\n\n[[Library]]\n[[Parameters Window]]\n[[Preferences]]</div>
<div tiddler="Library" modified="200603301751" modifier="Bruce" tags="">The TableSmith Library is an area where you can store generated results for later reference. It can be a handy area to keep names lists, generated towns, treasure lists, or anything that you've generated and might find useful in the future.\n\nThe Library interface is accessed via the &quot;File&quot; menu or simply by pressing F12 (the same selection in both cases returns you to the standard table generation interface). The Library consists of a tree on the left and a results window on the right. Items in ''bold'' in the hiearchy are categories, which you can create via the Library menu (see [[Menu and Toolbar]] for details). Items not in bold are saved results. When you click on one of these items, it will appear in the results window.\n\n&quot;Post-generation&quot; features still work in the Library, such as the &quot;re-roll&quot; feature. So, in that case, items that you can click on to &quot;re-roll&quot; can still be clicked on and recreated in the Library.\n\nFor further details on building and modifying the Library, see the Library section under [[Menu and Toolbar]].</div>
<div tiddler="InputText" modified="200604080122" modifier="YourName" tags="">!!!Format\n{~InputText~Default,Prompt}\n\n!!!Description\nThis function displays a dialog box that solicits input into a textbox. &quot;Default&quot; is used as the textbox's default value, &quot;Prompt&quot; is the text for the dialog itself. Whatever the user enters will be returned (or an empty string if the user hits &quot;Cancel&quot;).\n\nPutting &quot;&lt;br&gt;&quot; into &quot;Prompt&quot; will put carriage returns into the text displayed in the dialog.</div>
<div tiddler="While" modified="200604080129" modifier="YourName" tags="">!!!Format\n{While~X,Text}\n\n!!!Description\nDisplays the results of &quot;Text&quot; as long as &quot;X&quot; is not equal to 0.\n\n&quot;X&quot; can be a single value (such as that from a variable), or it can be a conditional expression (see [[If]] for more on conditional expressions).\n\n!!!Examples\n{While~%ctr%,[~GenName]} will return the results of the call to &quot;~GenName&quot; as long as the variable &quot;ctr&quot; is not 0.\n\n{While~%rolls%&lt;=%maxrolls%,[~GenName]} will return the results of the call to &quot;~GenName&quot; as long as the variable &quot;rolls&quot; is less than or equal to the variable &quot;maxrolls&quot;.</div>
<div tiddler="Version 4.5" modified="200604090134" modifier="YourName" tags="">* Added function: &quot;TableExists&quot;\n* DSWrite function now embeds carriage returns for human-readability\n* Fixed &quot;Dice&quot; function so dice with more than 32767 sides may be used\n* Fixed bug that would crash program if a value in scientific notation was entered for the number of rolls</div>
<div tiddler="Version 4.4" modified="200604090135" modifier="YourName" tags="">* Fixed bug with &quot;Cap&quot; function (didn't work properly if fed an empty string)\n* Added functions: &quot;DSCreate&quot;, &quot;DSAdd&quot;, &quot;DSCount&quot;, &quot;DSWrite&quot;, &quot;DSRead&quot;, &quot;DSSet&quot;, &quot;DSGet&quot;, &quot;DSRemove&quot;, &quot;DSFind&quot;, &quot;DSSort&quot;, &quot;DSRandomize&quot;\n* Following functions deprecated: &quot;~ArrNew&quot;, &quot;~ArrItem&quot;, &quot;~ArrGet&quot;, &quot;~ArrRemove&quot;, &quot;~ArrExists&quot;, &quot;~ArrClear&quot;, &quot;~ArrCount&quot;, &quot;Data&quot;</div>
<div tiddler="Version 4.2" modified="200604090136" modifier="YourName" tags="">* Added functions: &quot;[[Bold]]&quot;, &quot;[[CarRet]]&quot;, &quot;[[Generate]]&quot;, &quot;[[IIf]]&quot;, &quot;[[Italic]]&quot;, &quot;[[Line]]&quot;, &quot;[[Picture]]&quot;, &quot;[[Power]]&quot;, &quot;[[Version]]&quot;, and &quot;[[VowelStart]]&quot;\n* Added preliminary graphical editor</div>
<div tiddler="Version 4.1" modified="200604090137" modifier="YourName" tags="">* Added logical functions &quot;[[And]]&quot;, &quot;[[Or]]&quot;, and &quot;[[Xor]]&quot;\n* Command to allow tables to override UI settings added to [[Pre-Generation Directives]]\n* &quot;~OverrideRolls&quot; and &quot;~OutputType&quot; added to [[Pre-Generation Directives]]\n* Changed the format of the &quot;[[Left]]&quot;, &quot;[[Mid]]&quot;, and &quot;[[Right]]&quot; functions to fix potential problems if &quot;text&quot; included a comma\n* Fixed a bug where parameters with dashes would not function properly</div>
<div tiddler="Version 3.x" modified="200604090138" modifier="YourName" tags="">* Version 3.96\n** Enchanced &quot;[[Plural]]&quot; function\n** Added functions for associative arrays (~ArrNew, ~ArrItem, ~ArrGet, ~ArrRemove, ~ArrExists, ~ArrClear, ~ArrCount)\n\n* Version 3.95\n** Added many new functions ([[Count]], [[MinVal]], [[MaxVal]], [[Ceil]], [[Floor]], [[UCase]], [[LCase]], [[Loop]], [[Unlock]], [[Param]])\n** Enchanced &quot;[[If]]&quot; function\n** Removed obsolete group call functionality for conditional calls and looping\n** Truncation division ('\s') added to Calc function\n** Miscellaneous bug fixes\n** Allowed for the display of square brackets ('[',']')\n\n* Version 3.9\n** Added new functions ([[Calc]], Input, [[Debug]], [[Cap]], and [[AorAn]])\n** Allowed for the display of percent signs ('%')\n** Parameters may now be passed to groups in tables other than 'Start'\n** Printing and copying now available from the menu\n** Errors messages display table line numbers\n** Added option to turn off 'links' and 'notes' in HTML export\n\n* Version 3.8\n** Added &quot;[[If]]&quot; and &quot;[[Find]]&quot; functions\n** Replaced category file with folders in Tables directory\n** Allowed user to specify location of Tables directory\n** Allowed user to specify editor for editting table files\n** Added title/splash screen\n** Program now remembers desktop position from previous session\n\n* Version 3.7\n** Added &quot;[[Note]]&quot; function to allow user to annotate notes to results files\n** Added &quot;Archives&quot; feature to allow easy storage and retrieval of TableSmith results\n** Error dialogs now allow the user to cancel out of them\n** More new functions\n** Fixed bug where parameters didn't work when TableSmith was called from the command-line\n** Clicking on a &quot;re-roll&quot; link returns user to point of clicking\n\n* Version 3.6\n** Merged dice roll functionality into functions feature (function '[[Dice]]')\n** Added ~XML-reading capability via //Data// function\n** Conditional checks now allow checking with strings\n** Nesting of functions and group calls now permitted\n** Added many new functions\n** Improved error-handling\n\n* Version 3.5\n** Fixed problem that limited table results to 32768 characters\n** Added //Functions// to TableSmith format\n** Re-did parameter entry interface\n** Re-arranged main user interface\n** Added &quot;re-roll&quot; tag for table/group calls\n\n* Version 3.0\n** Unlimited variable support\n** Added/modified conditional tags\n** New operators added (&quot;&lt;&quot;, &quot;&gt;&quot;)</div>
<div tiddler="Earlier Versions" modified="200604090139" modifier="YourName" tags="">* Version 2.0\n** UI re-design\n** Parameter support\n** Additional group format\n** Added/modified conditional tags\n** Added non-duplication feature\n\n* Version 1.6\nAdded new tags for user-readability\n\n* Version 1.5\n** Changed Web browser control\n** Minor enhancements\n\n* Version 1.4\nMinor enchancements\n\n* Version 1.1\nAddition of variables and table modifiers\n\n* Version 1.0\nFirst implementation of the TableSmith</div>
<div tiddler="Advanced TableSmith Scripting" modified="200604121130" modifier="TableSmith" tags="">This section details the more advanced features of TableSmith. Included are details on variables (which allow you to preserve values or results within a table), parameters (allow you to solicit input from the user), functions (tools to accomplish things not possible with the basic TableSmith format), and other miscellaneous features.\n\n[[Variables]]\n[[Advanced Group Features]]\n[[Functions]]\n[[Datasets]]\n[[Parameters]]\n[[Pre-Generation Directives]]\n[[Miscellaneous]]</div>
<div tiddler="Stylesheets" modified="200604121224" modifier="TableSmith" tags="">!!!Format\n/Stylesheet nnnnn\n\n!!!Description\nIf the output is for HTML, a stylesheet link will be inserted into the beginning of the results file. &quot;nnnnn&quot; is the path to the stylesheet file.</div>
<div tiddler="Miscellaneous" modified="200604121226" modifier="TableSmith" tags="">!!!Command-line Parameters\nTableSmith will accept command-line parameters. The syntax is [Table Name.Group]:x. &quot;x&quot; is the number of rolls to make, while &quot;Table Name.Group&quot; is a standard group call (tags and modifiers work as normal).\n\n!!!Printing Special Characters\nIf you want to print an actual percent sign (&quot;%&quot;) or square bracket (&quot;[&quot;,&quot;]&quot;), precede the character with the slash character (&quot;/&quot;).\n\n!!!Re-roll Tag\nIf you preceed a group name with &quot;~&quot; in a group call, you can &quot;re-roll&quot; the results of that call. For instance: &quot;[~Treasure.Weapons]&quot;.\n\nThis tag allows the user to &quot;re-roll&quot; the results generated from the group call. Whatever text is returned by the call is displayed in the [[Results Window]] and is treated similar to an HTML hyperlink. The text will be in a dark-blue color (not underlined, however), and will change to light-blue when the cursor is placed over it. Clicking the text will &quot;re-roll&quot; it, while preserving the rest of the results. Note that this feature will not regenerate or recalculate other parts of a display. Variable changes that occur in the &quot;re-roll&quot; will not be reflected elsewhere in the results window (the primary purpose of this feature is to &quot;tweak&quot; results).\n\n!!!Tabs and Carriage Returns\nIf you want tabs or carriage returns in your output, use the characters &quot;^T&quot; and &quot;^M&quot;, respectively. This isn't as useful if you are using HTML output, but may be helpful for text or XML results.</div>
<div tiddler="Advanced Group Features" modified="200604121440" modifier="TableSmith" tags="">!!!Defaults\nA group can have default values which are always used when it is rolled on. A line beginning with &quot;&lt;&quot; will always be appended to the front of whatever line comes up, while a line beginning with &quot;&gt;&quot; will always be appended to the end. Example:\n\n;Treasure\n&lt;You find\n1, a gold necklace\n1, a pile of silver coins\n1, a large gem\n\nA call on &quot;Treasure&quot; will return &quot;You find XXX&quot;, where &quot;XXX&quot; is one of the items that may be generated.\n\nUsing defaults is optional. Also, you may have a starting default without an ending default, and vice-versa.\n\n!!!Dynamic Probabilities\nGenerally, group entries will have static values defining the odds they will be selected, whether as ranges of numbers or relative probabilities. You can, however, base an entry's probability of being selected on a variable in your table rather than with a static number. This allows for entries in a group to have their probabilities based on other results generated before the group is called.\n\nDynamic probabilities may only be defined with a variable; functions or group calls will not work. Also, dynamic probabilities will only work with groups using relative probability (with names preceded with &quot;;&quot;); groups using probability ranges (their names have &quot;:&quot; before them) will ignore dynamic entries.\n\nThe format of an entry with dynamic probability is:\n\n?%~VarName%,~EntryText\n\nThe line must begin with a &quot;?&quot;. Prior to the initial comma (&quot;,&quot;) is a variable name surrounded by percent signs &quot;%&quot;.\n\nEach time a group with dynamic probabilities is called, TableSmith will first recalculate the probability of each entry and then, based on the new ranges, generate a result. As such, this feature consumes more time during execution than if the called group was not dynamic.\n\nYou can mix static and dynamic probabilities in the same group (perhaps you only have a few entires that you want to set chances for &quot;on the fly&quot;). This will work, though naturally the static entries will retain their probabilities.\n\n!!!Splitting Group Entries\nGroup entries can be split into multiple lines. Whenever TableSmith reads in a line starting with an underscore (&quot;_&quot;), it appends that line to the previously read-in entry. Example:\n\n:Start\n1,You find [Weapon] and\n_ [~MagicItem]\n\nin a table file becomes:\n\n:Start\n1,You find [Weapon] and [~MagicItem]\n\ninternally.</div>
<div tiddler="Menu and Toolbar" modified="200604132300" modifier="YourName" tags="">At the top of the window is the menu and (at the top left side) the toolbar. Each button duplicates a commonly-used menu option. Each menu item is explained below:\n\n!!!File\n//Create New Category//\nCreate a new category folder in your Tables folder.\n\n//Create New Table//\nCreate a new table in the currently selected category.\n\n//Toggle ~Generator-Library//\nSwitches between the generator interface and the [[Library]] interface.\n\n//Print//\nPrint the results window.\n\n//Export Results//\nIf you wish to save the current batch of results, click this button. You will be prompted for a filename and location, and a file will be generated for you. This file will be in the format in the results window: HTML, XML, Text, or List (&quot;List&quot; is a text file that contains the items you've checked in a list-style results window).\n\n//Preferences//\nDisplays the [[Preferences]] dialog.\n\n//Exit//\nExits TableSmith.\n\n!!!Edit\n//Edit Table//\nAllows you to edit the selected table (see [[Basic File Format]] on editting).\n\n//Copy Selected to Clipboard//\nCopies selected text from the results window to the Windows clipboard.\n\n//Select All//\nSelects all text in the results window.\n\n!!!Table\n//Roll//\nRolls on the selected table. The number of results that will be generated is shown in the textbox left of the Dice button.\n\n//Reload//\nIf you create a new category folder, copy files into a category folder, or edit a Table file, and wish to use your changes immediately, you must first click the &quot;Reload&quot; button. This tells TableSmith to re-read the Tables folder and update itself accordingly. Note that 'reloading' is done automatically each time the program starts up.\n\n//Display Hidden Categories//\nNormally you don't see &quot;hidden&quot; categories (folders that start with &quot;~&quot;; see [[TableSmith Categories]] for more information). Selecting this menu option will allow you to see those categories and select tables from them.\n\n//Break//\nAllows you to &quot;break&quot;, or halt, the execution of the current table. This may generate error messages from that run if the table is halted in the middle of a function, though this is not cause for concern.\n\n//Set Parameters//\nOpens the [[Parameters Window]] to allow you to specify parameters for the current table (if it has parameters).\n\n//Add to Favorites//\nAdds the current table to your [[Favorites]] list.\n\n!!!Library\n''Note:'' The Library menu items are only enabled when you are viewing the Library interface. &quot;Add Results...&quot; is an exception; it is only enabled when you are viewing the main Generator interface.\n\n//New Category//\nIf a category is selected in the left-hand view, this menu item allows you to add another category at the same level.\n\n//New Subcategory//\nIf a category is selected in the left-hand view, this menu item allows you to add a category beneath it.\n\n//Move Item//\nAllows you to move the selected item (whether a category or saved result) to another category.\n\n//Delete Item//\nDeletes the selected item. If the item is a category, everything within that category will also be deleted.\n\n//Add Results to Library//\nAllows you to add the results currently in the Generator interface to the library.\n\n!!!Help\n//Help//\nDisplays this help information.\n\n//~Add-Ons...//\nDisplays information about any add-ons you may have installed.\n\n//About...//\nDisplays information about TableSmith.\n\n!!!Buttons\nThe buttons in the toolbar are used for &quot;Roll&quot;, &quot;Edit Table&quot;, &quot;Reload&quot;, and &quot;Set Parameters&quot;. They duplicate the functionality of the menu items of the same name.\n\n</div>
<div tiddler="Select" modified="200604151356" modifier="YourName" tags="">!!!Format\n{Select~Expr1,Value1,Result1,Value2,Result2,...,Default}\n\n!!!Description\n&quot;Select&quot; looks through a list of &quot;Value/Result&quot; pairs until it find a &quot;Value&quot; that matches &quot;Expr1&quot;. If it finds a matching value, the &quot;Result&quot; for the value is returned. If no match is found, &quot;Default&quot; is returned.\n\n!!!Example\n{Select~%class%,1,fighter,2,rogue,3,cleric,wizard}\n\nIf &quot;class&quot; contains 1, &quot;fighter&quot; is returned. If it's 2, then &quot;rogue&quot; is returned. &quot;cleric&quot; for 3, and if &quot;class&quot; is none of those &quot;wizard&quot; is returned.</div>
<div tiddler="Datasets" modified="200604160255" modifier="YourName" tags="">There are a number of functions (found in [[Functions]]) designed to be used with datasets. Some explanation is in order, however, as to what datasets actually are.\n\nAs the name implies, datasets are sets of data (for those familiar with databases, datasets are basically tables). A dataset is a collection of items that each have a common set of properties, called &quot;Fields&quot;. The items are in a particular order as well, and an item's place in this order is their &quot;Index&quot;.\n\nAn example of something you might put into a dataset would be a collection of magic items. Each item might be defined by a name, a type, a weight, and a value (you'd likely have more characteristics to use but these will serve as an example). These would be the fields in your dataset then: name, type, weight, and value. You would create your data set with DSCreate, defining your dataset with those values.\n\nAfter you created your dataset, you would then want to add values to it (DSCreate doesn't have anything in it; it just creates the &quot;container&quot; for your items). You do this by using DSAdd. You can define your item's &quot;fields&quot; with DSAdd when you create it or you can define them later by using DSSet.\n\nThe table below is a visual representation of a dataset, using the magic item example above. In this dataset, three items have been added and their values set.\n\n|!Index|!name|!type|!weight|!value|\n|1|healing potion|potion|0.5|75|\n|2|flaming sword|weapon|5|5000|\n|3|invisibility cloak|wondrous|1|10000|\n\nOnce you've created a dataset, added items to it, and set the values of the fields of those items, you can retrieve those values using DSGet. You can sort your items with DSSort and look for specific items with DSFind. If you want to remove an item from you dataset, DSRemove will handle that for you.\n\nFinally, if you want to save away your dataset for future use, you can write it to a file using DSWrite. Stored datasets can be re-loaded using DSRead.</div>
<div tiddler="InputList" modified="200604161622" modifier="YourName" tags="">!!!Format\n{~InputList~Default,Prompt,Option1,Option2,...}\n\n!!!Description\nThis function displays a dialog box that solicits the user to select something from a list. &quot;Default&quot; is the list item to be selected by default (the first item is 1, the second is 2, etc.). &quot;Prompt&quot; is the text for the dialog itself.\n\nThe number of the item the user selected will be returned by the function. If the user selects &quot;Cancel&quot;, InputList returns a zero.\n\nPutting &quot;&lt;br&gt;&quot; into &quot;Prompt&quot; will put carriage returns into the text displayed in the dialog.</div>
<div tiddler="Parameter Types" modified="200606222055" modifier="YourName" tags="">There are three types of parameters in TableSmith: Text, List, and ~Multi-List. They are described below (note: &quot;@&quot; is used in all cases to denote that what follows is parameter information).\n\n!!!Text\n''Format:'' @x,n,prompt\n\nA text parameter asks for free-form text input. &quot;x&quot; is the variable that will store the parameter value. &quot;n&quot; is the default text to use. &quot;prompt&quot; is text you want to display to the user, usually a question asking them to enter something.\n\n''Example:'' @religion,Odin,What deity does this character worship?\n\nThis parameter asks &quot;What deity...&quot; and lists &quot;Odin&quot; as the default. Whatever the user enters will go into the variable &quot;religion&quot;.\n\n!!!List\n''Format:'' @x,n,prompt,option1,option2,...optionx\n\nA list parameter displays a list of items (&quot;option1&quot;, &quot;option2&quot;, etc.). When an item is selected, a number that represents its place in the list is stored in &quot;x&quot;. &quot;n&quot; is the number of the item that's selected by default.\n\n''Example:'' @align,2,What is your alignment?,Lawful,Neutral,Chaotic\n\nThis parameter will show a list with &quot;Lawful&quot; first, &quot;Neutral&quot; next, and &quot;Chaotic&quot; third. The user is asked &quot;What is your...&quot;. &quot;Neutral&quot; will be selected to begin with since it is #2 in the list and &quot;2&quot; has been specified for the default.\n\n!!!~Multi-List\n''Format:'' @*x,n,prompt,option1,option2,...optionx\n\nA multi-list parameter is very similar to the &quot;list&quot; parameter above. The difference is &quot;list&quot; only allows you to select one item while &quot;multi-list&quot; allows you to select one, more than one, or none (each item in a &quot;multi-list&quot; has a checkbox next to it to indicate whether it's selected or not). &quot;multi-list&quot; parameters also have an asterisk (&quot;*&quot;) after the &quot;@&quot; sign.\n\nA single value is stored in the variable &quot;x&quot; as with the other parameter types, but this value is a bit special. It is a list of numbers; there are as many numbers as there are items in the list and each number is a &quot;0&quot; or a &quot;1&quot;, depending on whether an item has been selected (&quot;1&quot;) or not (&quot;0&quot;).\n\n''Example:'' @*types,0111,Treasure types:,Armor,Potions,Scrolls,Weapons\n\nThis parameter will show a list with the items &quot;Armor&quot;, &quot;Potions&quot;, etc. The default &quot;0111&quot; means that initially, &quot;Armor&quot; will //not// be selected, while the other three items will be.</div>
<div tiddler="TableExists" modified="200606261850" modifier="YourName" tags="">!!!Format\n{~TableExists~~TableName}\n\n!!!Description\nIf a table named &quot;~TableName.tab&quot; exists in one of the &quot;Tables&quot; folders, this function returns a &quot;1&quot;. Otherwise, it returns a &quot;0&quot;.</div>
<div tiddler="Pre-Generation Directives" modified="200612032100" modifier="YourName" tags="">You can put &quot;pre-generation directives&quot; in your table to override interface settings. A directive follows the following format:\n\n@@color(darkgreen):/~DirectiveCommand parameter(s)@@\n\nDirectives only are applied from tables that are called from the interface (i.e.; tables called from within other tables will have their directives ignored). Supported directives are listed below.\n\n[[Background Color]]\n[[Background Image]]\n[[Designate Output Type]]\n[[Output Footer]]\n[[Output Header]]\n[[Override Number of Rolls]]\n[[Stylesheets]]</div>
<div tiddler="Output Footer" modified="200612032103" modifier="YourName" tags="">!!!Format\n/~OutputFooter xxx\n\n!!!Description\nThe text in &quot;xxx&quot; will be displayed at the bottom of the results window. It will appear once, regardless of how many rolls have been designated.\n\nNote that the text in &quot;xxx&quot; will ''not'' be processed (so table calls, function calls, etc. will not be handled). The text will appear as it is shown.\n\n!!!Example\n/~OutputFooter (for room #14)\n\nThis will generate a result with the text &quot;(for room #14)&quot; at the bottom.</div>
<div tiddler="Output Header" modified="200612032104" modifier="YourName" tags="">!!!Format\n/~OutputHeader xxx\n\n!!!Description\nThe text in &quot;xxx&quot; will be displayed at the top of the results window. It will appear once, regardless of how many rolls have been designated.\n\nNote that the text in &quot;xxx&quot; will ''not'' be processed (so table calls, function calls, etc. will not be handled). The text will appear as it is shown.\n\n!!!Example\n/~OutputHeader Monster Names\n\nThis will generate a result with the text &quot;Monster Names&quot; at the top.</div>
<div tiddler="Iteration" modified="200612052102" modifier="YourName" tags="">!!!Format\n{Iteration~}\n\n!!!Description\nReturns the current iteration of the die roll (user-specified or table-overridden).\n\n!!!Example\nIf the die rolls are specified as 15 and the table is currently on its 8th iteration, {Iteration~} will return &quot;8&quot;</div>
<div tiddler="Line" modified="200701142004" modifier="Bruce" tags="">!!!Format\n{Line~Align,Width}\n\n!!!Description\nInserts a line across the page. Width is a percentage; if omitted, it will be be assumed to be 100%. &quot;Align&quot; can be &quot;left&quot;, &quot;center&quot;, or &quot;right&quot;.</div>
<div tiddler="SiteTitle" modified="200706192209" modifier="YourName" tags="">TableSmith 5.1</div>
<div tiddler="DSAdd" modified="200706192212" modifier="YourName" tags="">!!!Format\n{~DSAdd~~VarName,Field1,Value1,Field2,Value2,...}\n\n!!!Description\nAdds a new item to the end of the dataset &quot;~VarName&quot;. The values of &quot;Fieldx&quot; are set to &quot;Valuex&quot;. Setting Field values is optional, and those that aren't set will be equal to whatever is defined as the dataset's defaults. ~DSAdd will return the index of the new item (which will also be equal to the number of items in the dataset).\n\nNote: If you don't want the index returned, use &quot;~DSAddNR&quot; (''N''o ''R''eturn) rather than &quot;~DSAdd&quot;. Both function exactly the same but ~DSAddNR doesn't return a value.\n\n!!!Example\n{~DSAdd~weapons,name,longsword,weight,15,cost,30}\n\nThis adds a new record to the dataset &quot;weapons&quot; and sets the record's &quot;name&quot; to &quot;longsword&quot;, &quot;weight&quot; to 15, and &quot;cost&quot; to 30.\n</div>
<div tiddler="DSAddNR" modified="200706192213" modifier="YourName" tags="">See DSAdd</div>
<div tiddler="Functions - Grouped by Category" modified="200708310736" modifier="Bruce" tags="">!!!Conditional\n[[If]] (Choose one option or another)\nIIf (Choose one option or another)\n[[Loop]] (Repeat something a number of times)\n[[Select]] (Choose one option of many)\n[[While]] (While loop)\n\n!!!Datasets\nDSAdd (Add item)\nDSCalc (Calculate on items)\nDSCount (Count items)\nDSCreate (Create dataset)\nDSFind (Find an item)\nDSGet (Get a value from an item)\nDSRandomize (Randomize items)\nDSRead (Read in a dataset file)\nDSRemove (Remove an item)\nDSRoll (Roll for an item)\nDSSet (Set a value in an item)\nDSSort (Sort items)\nDSWrite (Write dataset to a file)\n\n!!!Groups and Tables\n[[Count]] (Count group entries)\n[[Lockout]] (Lockout entries in a non-repeating group)\nMaxVal (Maximum value of entry)\nMinVal (Minimum value of entry)\n[[Reset]] (Reset group)\n[[Stop]] (Stop table generation)\n[[Unlock]] (Unlock entry)\n[[Used]] (Used already)\n\n!!!Interface\n[[Generate]] (Generation link)\nInputList (Input a list option from the user)\nInputText (Input a value from the user)\n[[Iteration]] (Get the current roll the table is on)\n[[Msg]] (Message box)\n[[Note]] (Notation)\n[[Status]] (Display status)\n\n!!!Logical\n[[And]] (Logical And)\n[[Or]] (Logical OR)\n[[Xor]] (Logical exclusive OR)\n\n!!!Mathematical\n[[Abs]] (Absolute value)\n[[Calc]] (Calculate)\n[[Ceil]] (Ceiling integer)\n[[Floor]] (Floor integer)\n[[Max]] (Maximum value)\n[[Min]] (Minimum value)\n[[Mod]] (Remainder)\n[[Power]] (Raise to a power)\n[[Round]] (Rounding)\n[[Sqrt]] (Square root)\n[[Trunc]] (Truncate)\n\n!!!Miscellaneous\n[[Debug]] (Debug)\n[[Dice]] (Roll dice)\n[[Extern]] (External call)\n[[Log]] (Append to a log file)\n[[LogNew]] (Write to a new log file)\nOrderAsc (Order ascending)\nOrderDesc (Order descending)\n[[Param]] (Parameter item)\nTableExists (Does a table exist)\n[[Version]] (Version)\n\n!!!Formatting and Layout\n[[Bold]] (Boldface)\n[[CarRet]] (Carriage return)\n[[Color]] (Color text)\n[[Italic]] (Italicize text)\n[[Line]] (Insert a horizontal line)\n[[Picture]] (Display picture)\n\n!!!Text\nAorAn (A or An)\n[[Cap]] (Capitalize)\n[[CapEachWord]] (Capitalize each word)\n[[Char]] (Retrieve a single character)\n[[CommaReplace]] (Replace or insert commas)\n[[Find]] (Find text within other text)\nLCase (Lower case)\n[[Left]] (Retrieve leftmost characters)\n[[Length]] (Get the length of some text)\n[[Mid]] (Retrieve middle characters)\n[[Ordinal]] (Ordinal number)\n[[Plural]] (Make string plural)\n[[PluralIf]] (Conditional make string plural)\n[[Replace]] (Replace text)\nUCase (Upper case)\n[[Right]] (Retrieve rightmost characters)\n[[Space]] (Insert spaces)\n[[Split]] (Split)\n[[Trim]] (Trim spaces)\nVowelStart (Vowel starts)</div>
<div tiddler="Functions - Listed Alphabetically" modified="200708310737" modifier="Bruce" tags="">[[Abs]] (Absolute value)\n[[And]] (Logical And)\nAorAn (A or An)\n[[Bold]] (Boldface)\n[[Calc]] (Calculate)\n[[Cap]] (Capitalize)\n[[CapEachWord]] (Capitalize each word)\n[[CarRet]] (Carriage return)\n[[Ceil]] (Ceiling integer)\n[[Char]] (Retrieve a single character)\n[[Color]] (Color text)\n[[CommaReplace]] (Replace or insert commas)\n[[Count]] (Count group entries)\n[[Debug]] (Debug)\n[[Dice]] (Roll dice)\nDSAdd (Add item)\nDSCalc (Calculate on items)\nDSCount (Count items)\nDSCreate (Create dataset)\nDSFind (Find an item)\nDSGet (Get a value from an item)\nDSRandomize (Randomize items)\nDSRead (Read in a dataset file)\nDSRemove (Remove an item)\nDSRoll (Roll for an item)\nDSSet (Set a value in an item)\nDSSort (Sort items)\nDSWrite (Write dataset to a file)\n[[Extern]] (External call)\n[[Find]] (Find text within other text)\n[[Floor]] (Floor integer)\n[[Generate]] (Generation link)\n[[If]] (Choose one option or another)\nIIf (Choose one option or another)\nInputList (Input a list option from the user)\nInputText (Input a value from the user)\n[[Italic]] (Italicize text)\n[[Iteration]] (Get the current roll the table is on)\nLCase (Lower case)\n[[Left]] (Retrieve leftmost characters)\n[[Length]] (Get the length of some text)\n[[Line]] (Insert a horizontal line)\n[[Lockout]] (Lockout entries in a non-repeating group)\n[[Log]] (Append to a log file)\n[[LogNew]] (Write to a new log file)\n[[Loop]] (Repeat something a number of times)\n[[Max]] (Maximum value)\nMaxVal (Maximum value of entry)\n[[Mid]] (Retrieve middle characters)\n[[Min]] (Minimum value)\nMinVal (Minimum value of entry)\n[[Mod]] (Remainder)\n[[Msg]] (Message box)\n[[Note]] (Notation)\n[[Or]] (Logical OR)\nOrderAsc (Order ascending)\nOrderDesc (Order descending)\n[[Ordinal]] (Ordinal number)\n[[Param]] (Parameter item)\n[[Picture]] (Display picture)\n[[Plural]] (Make string plural)\n[[PluralIf]] (Conditional make string plural)\n[[Power]] (Raise to a power)\n[[Replace]] (Replace text)\n[[Reset]] (Reset group)\n[[Right]] (Retrieve rightmost characters)\n[[Round]] (Rounding)\n[[Select]] (Choose one option of many)\n[[Space]] (Insert spaces)\n[[Split]] (Split)\n[[Sqrt]] (Square root)\n[[Status]] (Display status)\n[[Stop]] (Stop table generation)\nTableExists (Does a table exist)\n[[Trim]] (Trim spaces)\n[[Trunc]] (Truncate)\nUCase (Upper case)\n[[Unlock]] (Unlock entry)\n[[Used]] (Used already)\n[[Version]] (Version)\nVowelStart (Vowel starts)\n[[While]] (While loop)\n[[Xor]] (Logical exclusive OR)</div>
<div tiddler="Variables" modified="200708310746" modifier="Bruce" tags="">TableSmith supports variables, which can be thought of as storage areas for numbers, text, or other information. Variables must be named, and can be called anything you want (though you are ''strongly'' advised to just use alphanumeric characters - that is, letters and numbers). A variable name can contain spaces, though not at the beginning or end of the name.\n\nVariables must be &quot;declared&quot; in a TableSmith file before anything else (including [[Parameters]], which are detailed elsewhere). A variable declaration is a single line formatted as follows:\n\n@@color(darkgreen):%~VariableName%,x@@\n\n&quot;~VariableName&quot; is whatever name you choose for the variable, and &quot;x&quot; is the default value that the variable will have (i.e.; whatever value it has until reassigned or modified). Variables can store text or numbers.\n\nWhenever an entry has something between two percent signs (&quot;%&quot;), TableSmith reads this as a //variable reference//. If you have a variable with a name matching whatever is between the &quot;%&quot; characters, the value that is currently in that variable replaces the reference. For instance, say the variable &quot;amount&quot; currently holds the value &quot;12&quot;. The following line in a TableSmith file:\n\n&quot;There are %amount% orcs here.&quot;\n\nwill display as:\n\n&quot;There are 12 orcs here.&quot;\n\n!!!Variable Assignments\nWhenever an entry has something in two sets of pipes (&quot;|&quot;), it is recognized by TableSmith as a //variable assignment//. The format of an assignment is:\n\n@@color(darkgreen): |xxxxx?Y|@@\n\nwhere\n\nxxxxx is a variable name (//without// the &quot;%&quot;)\n? is +, -, *, /, \s, &gt;, &lt;, &amp;, or =\nY is a numeric value\n\nUse one of the nine symbols shown by &quot;?&quot; above to change a variable. Using &quot;=&quot; will assign the text or number that follow to the specified variable, while the other symbols will perform that action on the variable (usually only practical if the variable holds a number). Examples are shown below:\n\n''|A+5|'' - Adds 5 to &quot;A&quot; (Ex: If &quot;A&quot; was 3, it is now 8)\n''|hp-3|'' - Subtracts 3 from &quot;hp&quot; (Ex: If &quot;hp&quot; was 4, it is now 1)\n''|gp*2|'' - Multiplies &quot;gp&quot; by 2 (Ex: If &quot;gp&quot; was 50, it is now 100)\n''|dmg/2|'' - Divides &quot;dmg&quot; by 2 (Ex: If &quot;dmg&quot; was 10, it is now 5)\n''|attr\s2|'' - Divides &quot;attr&quot; by 2, rounds fractions (Ex: If &quot;attr&quot; was 5, it is now 2)\n''|A&gt;35|'' - Assigns 35 to &quot;A&quot;, if 35 is greater than A's value\n''|A&lt;14|'' - Assigns 14 to &quot;A&quot;, if 14 is less than A's value\n''|A&amp; III|'' - Concatenates the text &quot; III&quot; to A's value (Ex: If &quot;A&quot; was &quot;Smith&quot;, it is now &quot;Smith III&quot;)\n''|A=orc|'' - Sets &quot;A&quot; equal to the word &quot;orc&quot;\n\nVariables are local to the table they are used in. In other words, if you have a reference to &quot;A&quot; in one table and a reference to &quot;A&quot; in another that is called by the first, the value of &quot;A&quot; in one table will not be affected by changes in the other.\n\nUnlike the other TableSmith items, a variable assignment does not get replaced by anything visible. The entire assignment is simply removed from the line - &quot;This is |B=5|a test&quot; would be viewed as &quot;This is a test&quot;.\n\n!!!Variables in Other Tables\nVariables in other tables may be accessed by prefacing the variable name with &quot;!&quot; and the table name. &quot;|Treasure!Maximum=50000|&quot; would, for instance, set the value of the variable &quot;Maximum&quot; to 50000 in the table &quot;Treasure&quot;. Similarly, &quot;%Town!Population%&quot; would display whatever value the variable &quot;Population&quot; in the table &quot;Town&quot; holds.\n\n!!!Scripts in Variable Defaults\nRather than a static value, a variable declaration can have an element of scripting in it, such as &quot;%Class%,[Class]&quot;. Note that the default value is ''not'' evaluated if this is done. Whatever scripting is used for the default will be used for the variable whenever it is referenced. Using the above example, each time &quot;%Class%&quot; appears in a table, it is replaced by &quot;[Class]&quot;, meaning the &quot;Class&quot; group will be called each time. It is recommended that in cases like this, you use &quot;dummy&quot; values as a default, and then assign a value to your variable elsewhere in your table (example: &quot;|Class=[Class]|&quot;).</div>
<div tiddler="If" modified="200708310756" modifier="Bruce" tags="">!!!Format\n{If~Expr ? Result1/Result2}\n\n!!!Description\nIf the &quot;Expr&quot; is true, &quot;Result1&quot; is returned. &quot;Result2&quot; is returned otherwise.\n&quot;Result2&quot; is optional. If there is no &quot;Result2&quot; and the value of &quot;Expr&quot; is false, nothing is returned.\n\n&quot;Expr&quot; is an expression consisting of two values compared to one another - whether the values equal one another, whether one is larger, etc. The valid types of expressions are:\n* &quot;=&quot; (equals)\n*&quot;!=&quot; (does not equal)\n*&quot;&lt;&quot; (less than)\n*&quot;&gt;&quot; (greater than)\n*&quot;&lt;=&quot; (less than or equal)\n*&quot;&gt;=&quot; (greater than or equal)\n\n!\nNote: Spaces before or after a value are ignored in the expression. So &quot; red&quot;, &quot; red &quot;, and &quot; red &quot; would all be evaluated as equal values.\n\n!!!Example\nIf the variable &quot;Class&quot; is 1, {If~%Class% = 1 ? warrior / wizard} will return &quot;warrior&quot;; otherwise, it will return &quot;wizard&quot;.</div>
<div tiddler="Version 5.1" modified="200708310757" modifier="Bruce" tags="">*&quot;~OutputHeader&quot; and &quot;~OutputFooter&quot; added to [[Pre-Generation Directives]].\n*New functions: [[Color]], [[DSAddNR]], [[Iteration]]\n*Enhancement: Added splitter between Tables and Favorites areas to allow them to be re-sized.\n*Enhancement: Colons (&quot;:&quot;) may now be used in re-rollable link text.\n*Enhancement: Enter may be chosen in InputList after an entry is chosen with arrow keys (this is consistent with the parameters dialog).\n*Enhancement: Hitting 'Escape' now closes the parameters window.\n*Enhancement: The Library folder can now use relative pathing.\n*Bug fix: Function calls not longer generate an error if the entire call was six characters in length.\n*Bug fix: AorAn will now return &quot;an&quot; if the passed-in text was capitalized.\n*Bug fix: A missing comma in a variable declaration now gives a real error message rather than a generic system message</div>
<div tiddler="System Requirements" modified="200708310804" modifier="Bruce" tags="">TableSmith is a 32-bit Windows application. Any system with Windows 98 or a newer version should have no problem running the program. For optimum performance, a display setting with at least 256 colors should be used.\n\nTableSmith also requires the .NET Framework (version 2.0 or 3.0) to be installed on your PC. The Framework can be downloaded from the [[Microsoft web site|http://www.microsoft.com]]. If you are running Windows XP with Service Pack 2 or Windows Vista, the .NET Framework should already be installed.\n\nNote: TableSmith is not supported on Windows 95.</div>
<div tiddler="Legal Information" modified="200708310805" modifier="Bruce" tags="">The TableSmith software is owned by Bruce Gulke. Bruce Gulke grants to the user a nonexclusive license to use the TableSmith software solely for his or her personal purposes. The user may not commercially distribute, sublicense, resell, or otherwise transfer for any consideration, or reproduce for any such purposes, the TableSmith software or any modification or derivation thereof, nor the results generated by the program, either alone or in conjunction with any other product or program. Further, the user may not modify the TableSmith software, other than for his or her own personal use.\n\nThis software and accompanying electronic materials are provided &quot;as is&quot; without warranty of any kind. Further, Bruce Gulke does not guarantee, warrant, or make any representations regarding the use, or the results of use, of the software or electronic materials in terms of correctness, reliability, accuracy, or otherwise. All risk as to the results and/or performance of the software is assumed by you. If the software or electronic material are defective, you, and not Bruce Gulke or his authorized representatives, assume the entire cost of all necessary service, repair, or other correction.\n\nThe above is the only warranty of any kind, either express or implied, including but not limited to the implied warranties of merchantability and fitness for a particular purpose, that is made by Bruce Gulke on this software. No oral or written information or advice given by Bruce Gulke or his authorized representatives shall create a warranty or in any way increase the scope of this warranty and you may not rely on any such advice or information.\n\nNeither Bruce Gulke nor anyone else who has been involved in the creation, production, testing, distribution, or delivery of this software shall be liable for any direct, indirect, consequential, or incidental damages, (including damages for business interruption, loss of business profits, loss of business information, or anything of the like) arising out of the use or inability to use said software even if Bruce Gulke has been advised of the possibility of such damages.\n\nBy using the TableSmith you acknowledge that you have read this statement, understand it, and agree to be bound by its terms and conditions.</div>
<div tiddler="Version 4.0x" modified="200708310808" modifier="Bruce" tags="">* Version 4.03\n** A loaded XML file will refresh with click of Reload button, as tables do\n** Added &quot;Break&quot; feature\n** Added toggle to menu for switching between generator and archives\n** Modified &quot;[[Used]]&quot; function to check if an entire group has been &quot;used up&quot;\n** Made more functions keyboard-accessible\n** Added option to immediately re-roll the table you have currently selected when you click &quot;Reload&quot;\n** Fixed a bug with the &quot;[[While]]&quot; function that prevented it from working if not at the beginning of an entry\n\n* Version 4.0\n** Added the following functions: &quot;[[Ordinal]]&quot;, &quot;Shell&quot;, &quot;[[Extern]]&quot;, &quot;[[While]]&quot;\n** Allowed display and export to XML and text as well as HTML</div>
<div tiddler="Revision History" modified="200708310808" modifier="Bruce" tags="">[[Version 5.1]]\n[[Version 5.0]]\n[[Version 4.5]]\n[[Version 4.4]]\n[[Version 4.3]]\n[[Version 4.2]]\n[[Version 4.1]]\n[[Version 4.0x]]\n[[Version 3.x]]</div>
<div tiddler="Version 4.3" modified="200708310809" modifier="Bruce" tags="">* Converted internal data types to support numbers larger than 32767\n* Added functions: &quot;CR&quot;, &quot;~LastRoll&quot;, &quot;[[Log]]&quot;, &quot;[[Mod]]&quot;\n* Functionality added to allow for accessing variables in other tables\n* &quot;Create New Table&quot; menu option added\n* &quot;Display Hidden Categories&quot; menu option added\n* &quot;~BackColor&quot; and &quot;Background&quot; added to [[Pre-Generation Directives]]\n</div>
<div tiddler="Version 5.0" modified="200708310813" modifier="Bruce" tags="">* [[Generate]] function enhanced to allow modifiers (+,-,=) as in a regular group call\n* [[Generate]] function enhanced to allow preceding group call with &quot;~&quot;\n* DSAdd function enhanced to allow setting values of fields for new records\n* Error messages displayed in red and bold to be seen easier\n* First easter egg\n* Added functions: &quot;[[Char]]&quot;, &quot;CommaReplace&quot;, &quot;DSCalc&quot;, &quot;DSRoll&quot;, &quot;InputList&quot;, &quot;InputText&quot;, &quot;LogNew&quot;, &quot;PluralIf&quot;, &quot;[[Select]]&quot;, &quot;[[Space]]&quot;\n* Improved error-handling\n* Group Defaults added\n* Added dynamic probabilities for group entries\n* Added pre-generation directive for stylesheets\n* Added &quot;List&quot; output type\n* Added &quot;Multi-list&quot; parameter type\n* Deprecated &quot;LN~&quot; tag; replaced with &quot;~&quot;\n* Changed function formats: &quot;Power&quot; and &quot;Round&quot;\n* &quot;~SortAsc&quot; and &quot;~SortDesc&quot; removed\n* Removed textured backgrounds\n* Enhanced &quot;While&quot; to handle conditionals\n* Creating a new table from the menu defaults to the current category\n* Added ability to create new categories\n* Parameters moved to self-contained dialog box\n* Help file moved to searchable wiki\n* Moved program to .NET Framework\n* &quot;Input&quot; function deprecated</div>
<div tiddler="Category and Table Lists" modified="200709090122" modifier="YourName" tags="">Below the toolbar you will find a drop-down list and a standard listbox, the first for Categories and the other for Tables.\n\nThe Category list is used to select Table Categories. When a Category is selected, all the Tables in that Category will be loaded into the Table list. When a Table is selected in that list, it is the one that will be used when the &quot;Roll&quot; button is clicked.\n\nThe Table list can be made longer or shorter. Move the cursor to just below the table; when it changes to a line with two arrows on it, click the left mouse button and drag the mouse up or down to adjust the size of the list. Making the Table list longer will shorten the [[Favorites]] list, and vice-versa.\n\nSee [[TableSmith Categories]] for more information.</div>
<div tiddler="Color" modified="200709090128" modifier="YourName" tags="">!!!Format\n{Color~Color,Text}\n\n!!!Description\nSets the color of &quot;Text&quot; to &quot;Color&quot;. &quot;Color&quot; can be be a hex value such as &quot;00FF00&quot; or it can be a color name like &quot;Lime&quot;. Refer to an HTML color reference on the Internet for valid values to use for &quot;Color&quot;; a useful one is listed below.\n\nhttp://www.w3schools.com/tags/ref_colornames.asp</div>
<div tiddler="Background Image" modified="200806042142" modifier="YourName" tags="">!!!Format\n/Background nnnnn\n\n!!!Description\nIf the output is for HTML, the background image will be set to &quot;nnnnn&quot;. Remember that this is relative to where the HTML\nresults file is, so you may want to use an absolute path.\n\n!!!Example\n/Background &quot;scroll.jpg&quot;\n\nThis will display the file &quot;scroll.jpg&quot; as the background image in an HTML results display.</div>
<div tiddler="Support" modified="200806042315" modifier="YourName" tags="">TableSmith is shipped fully functional. If you have problems or questions, contact the author via e-mail at akira@mythosa.net.\n\nTechnical support for unregistered users will only be provided for problems dealing with download or installation. Registered users will receive technical support for the program itself. Please see the [[Registration]] section for information on registering TableSmith.\n\nAdditional support is available from fellow users at the following sites:\n* [[Yahoo! TableSmith Group|http://games.groups.yahoo.com/group/TableSmith/]]: A great place to ask questions, find new tables, and collaborate on table design.\n* [[TableSmith Wiki|http://the-gaming-resource.com/TSWiki/tiki-index.php]]: A collection of tips, tricks, tutorials, and other helpful information from the TableSmith community.\n\nSpecial thanks to the following folks:\n* Ricky Hunt: Owner/moderator of the Yahoo list\n* Valminder: Master of file organization on the Yahoo list \n* Bo Whitten: Host of the TableSmith wiki\n* The members of the Yahoo list who have been helpful to other members over the years (often providing answers before I even see the questions), as well as other folks who have promoted the program, including but not limited to: Larry Cormier, Steve Davies, Tim Dugger, Troy Fisher, John Grigsby, Darren Hill, Todd Landrum, Kheferen, Dale Maxwell, Vance Reed, Erin Smale, Dalton S. Spence, Telas, Gary Whitten\n* Everyone who's registered - thank you all!</div>
		</div>
</body>
</html>